(function(a){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],a)}else{if(typeof module==='object'&&module.exports){module.exports=a(require('jquery'))}else{a(window.jQuery)}}}(function($){"use strict";$.fn.fileinputLocales={};$.fn.fileinputThemes={};String.prototype.setTokens=function(a){var b=this.toString(),key,re;for(key in a){if(a.hasOwnProperty(key)){re=new RegExp("\{"+key+"\}","g");b=b.replace(re,a[key])}}return b};var v,FileInput;v={FRAMES:'.kv-preview-thumb',SORT_CSS:'file-sortable',OBJECT_PARAMS:'<param name="controller" value="true" />\n'+'<param name="allowFullScreen" value="true" />\n'+'<param name="allowScriptAccess" value="always" />\n'+'<param name="autoPlay" value="false" />\n'+'<param name="autoStart" value="false" />\n'+'<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n'+'<span class="{previewFileIconClass}">{previewFileIcon}</span>\n'+'</div>',MODAL_ID:'kvFileinputModal',MODAL_EVENTS:['show','shown','hide','hidden','loaded'],objUrl:window.URL||window.webkitURL,compare:function(a,b,c){return a!==undefined&&(c?a===b:a.match(b))},isIE:function(a){if(navigator.appName!=='Microsoft Internet Explorer'){return false}if(a===10){return new RegExp('msie\\s'+a,'i').test(navigator.userAgent)}var b=document.createElement("div"),status;b.innerHTML="<!--[if IE "+a+"]> <i></i> <![endif]-->";status=b.getElementsByTagName("i").length;document.body.appendChild(b);b.parentNode.removeChild(b);return status},canAssignFilesToInput:function(){var a=document.createElement('input');try{a.type="file";a.files=null;return true}catch(err){return false}},getDragDropFolders:function(a){var i,item,len=a.length,folders=0;if(len>0&&a[0].webkitGetAsEntry()){for(i=0;i<len;i++){item=a[i].webkitGetAsEntry();if(item&&item.isDirectory){folders++}}}return folders},initModal:function(a){var b=$('body');if(b.length){a.appendTo(b)}},isEmpty:function(a,b){return a===undefined||a===null||a.length===0||(b&&$.trim(a)==='')},isArray:function(a){return Array.isArray(a)||Object.prototype.toString.call(a)==='[object Array]'},ifSet:function(a,b,c){c=c||'';return(b&&typeof b==='object'&&a in b)?b[a]:c},cleanArray:function(a){if(!(a instanceof Array)){a=[]}return a.filter(function(e){return(e!==undefined&&e!==null)})},spliceArray:function(a,b,c){var i,j=0,out=[],newArr;if(!(a instanceof Array)){return[]}newArr=$.extend(true,[],a);if(c){newArr.reverse()}for(i=0;i<newArr.length;i++){if(i!==b){out[j]=newArr[i];j++}}if(c){out.reverse()}return out},getNum:function(a,b){b=b||0;if(typeof a==="number"){return a}if(typeof a==="string"){a=parseFloat(a)}return isNaN(a)?b:a},hasFileAPISupport:function(){return!!(window.File&&window.FileReader)},hasDragDropSupport:function(){var a=document.createElement('div');return!v.isIE(9)&&(a.draggable!==undefined||(a.ondragstart!==undefined&&a.ondrop!==undefined))},hasFileUploadSupport:function(){return v.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob())}catch(e){return false}},hasArrayBufferViewSupport:function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(e){return false}},dataURI2Blob:function(a){var b=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,canBlob=v.hasBlobSupport(),byteStr,arrayBuffer,intArray,i,mimeStr,bb,canProceed=(canBlob||b)&&window.atob&&window.ArrayBuffer&&window.Uint8Array;if(!canProceed){return null}if(a.split(',')[0].indexOf('base64')>=0){byteStr=atob(a.split(',')[1])}else{byteStr=decodeURIComponent(a.split(',')[1])}arrayBuffer=new ArrayBuffer(byteStr.length);intArray=new Uint8Array(arrayBuffer);for(i=0;i<byteStr.length;i+=1){intArray[i]=byteStr.charCodeAt(i)}mimeStr=a.split(',')[0].split(':')[1].split(';')[0];if(canBlob){return new Blob([v.hasArrayBufferViewSupport()?intArray:arrayBuffer],{type:mimeStr})}bb=new b();bb.append(arrayBuffer);return bb.getBlob(mimeStr)},arrayBuffer2String:function(a){if(window.TextDecoder){return new TextDecoder("utf-8").decode(a)}var b=Array.prototype.slice.apply(new Uint8Array(a)),out='',i=0,len,c,char2,char3;len=b.length;while(i<len){c=b[i++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:out+=String.fromCharCode(c);break;case 12:case 13:char2=b[i++];out+=String.fromCharCode(((c&0x1F)<<6)|(char2&0x3F));break;case 14:char2=b[i++];char3=b[i++];out+=String.fromCharCode(((c&0x0F)<<12)|((char2&0x3F)<<6)|((char3&0x3F)<<0));break}}return out},isHtml:function(b){var a=document.createElement('div');a.innerHTML=b;for(var c=a.childNodes,i=c.length;i--;){if(c[i].nodeType===1){return true}}return false},isSvg:function(a){return a.match(/^\s*<\?xml/i)&&(a.match(/<!DOCTYPE svg/i)||a.match(/<svg/i))},getMimeType:function(a,b,c){switch(a){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return'image/jpeg';case'89504E47':return'image/png';case'47494638':return'image/gif';case'49492a00':return'image/tiff';case'52494646':return'image/webp';case'66747970':return'video/3gp';case'4f676753':return'video/ogg';case'1a45dfa3':return'video/mkv';case'000001ba':case'000001b3':return'video/mpeg';case'3026b275':return'video/wmv';case'25504446':return'application/pdf';case'25215053':return'application/ps';case'504b0304':case'504b0506':case'504b0508':return'application/zip';case'377abcaf':return'application/7z';case'75737461':return'application/tar';case'7801730d':return'application/dmg';default:switch(a.substring(0,6)){case'435753':return'application/x-shockwave-flash';case'494433':return'audio/mp3';case'425a68':return'application/bzip';default:switch(a.substring(0,4)){case'424d':return'image/bmp';case'fffb':return'audio/mp3';case'4d5a':return'application/exe';case'1f9d':case'1fa0':return'application/zip';case'1f8b':return'application/gzip';default:return b&&!b.match(/[^\u0000-\u007f]/)?'application/text-plain':c}}}},addCss:function(a,b){a.removeClass(b).addClass(b)},getElement:function(a,b,c){return(v.isEmpty(a)||v.isEmpty(a[b]))?c:$(a[b])},uniqId:function(){return Math.round(new Date().getTime())+'_'+Math.round(Math.random()*100)},htmlEncode:function(a){return a.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&apos;')},replaceTags:function(c,d){var e=c;if(!d){return e}$.each(d,function(a,b){if(typeof b==="function"){b=b()}e=e.split(a).join(b)});return e},cleanMemory:function(a){var b=a.is('img')?a.attr('src'):a.find('source').attr('src');v.objUrl.revokeObjectURL(b)},findFileName:function(a){var b=a.lastIndexOf('/');if(b===-1){b=a.lastIndexOf('\\')}return a.split(a.substring(b,b+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(a){var b=document,de=b.documentElement;if(de&&a&&!v.checkFullScreen()){if(de.requestFullscreen){de.requestFullscreen()}else if(de.msRequestFullscreen){de.msRequestFullscreen()}else if(de.mozRequestFullScreen){de.mozRequestFullScreen()}else if(de.webkitRequestFullscreen){de.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(b.exitFullscreen){b.exitFullscreen()}else if(b.msExitFullscreen){b.msExitFullscreen()}else if(b.mozCancelFullScreen){b.mozCancelFullScreen()}else if(b.webkitExitFullscreen){b.webkitExitFullscreen()}}},moveArray:function(a,b,c,d){var e=$.extend(true,[],a);if(d){e.reverse()}if(c>=e.length){var k=c-e.length;while((k--)+1){e.push(undefined)}}e.splice(c,0,e.splice(b,1)[0]);if(d){e.reverse()}return e},cleanZoomCache:function(a){var b=a.closest('.kv-zoom-cache-theme');if(!b.length){b=a.closest('.kv-zoom-cache')}b.remove()},setOrientation:function(a,b){var c=new DataView(a),idx=0,value=1,maxBytes,uInt16,exifLength;if(c.getUint16(idx)!==0xFFD8||a.length<2){if(b){b()}return}idx+=2;maxBytes=c.byteLength;while(idx<maxBytes-2){uInt16=c.getUint16(idx);idx+=2;switch(uInt16){case 0xFFE1:exifLength=c.getUint16(idx);maxBytes=exifLength-idx;idx+=2;break;case 0x0112:value=c.getUint16(idx+6,false);maxBytes=0;break}}if(b){b(value)}},validateOrientation:function(a,b){if(!window.FileReader||!window.DataView){return}var c=new FileReader(),buffer;c.onloadend=function(){buffer=c.result;v.setOrientation(buffer,b)};c.readAsArrayBuffer(a)},adjustOrientedImage:function(a,b){var c,offsetTop,newTop;if(!a.hasClass('is-portrait-gt4')){return}if(b){a.css({width:a.parent().height()});return}else{a.css({height:'auto',width:a.height()})}c=a.parent().offset().top;offsetTop=a.offset().top;newTop=c-offsetTop;a.css('margin-top',newTop)},closeButton:function(a){a=a?'close '+a:'close';return'<button type="button" class="'+a+'" aria-label="Close">\n'+'  <span aria-hidden="true">&times;</span>\n'+'</button>'}};FileInput=function(a,b){var c=this;c.$element=$(a);c.$parent=c.$element.parent();if(!c._validate()){return}c.isPreviewable=v.hasFileAPISupport();c.isIE9=v.isIE(9);c.isIE10=v.isIE(10);if(c.isPreviewable||c.isIE9){c._init(b);c._listen()}c.$element.removeClass('file-loading')};FileInput.prototype={constructor:FileInput,_cleanup:function(){var a=this;a.reader=null;a.formdata={};a.uploadCount=0;a.uploadStatus={};a.uploadLog=[];a.uploadAsyncCount=0;a.loadedImages=[];a.totalImagesCount=0;a.ajaxRequests=[];a.clearStack();a.fileBatchCompleted=true;if(!a.isPreviewable){a.showPreview=false}a.isError=false;a.ajaxAborted=false;a.cancelling=false},_init:function(c,d){var e=this,f,$el=e.$element,$cont,t,tmp;e.options=c;$.each(c,function(a,b){switch(a){case'minFileCount':case'maxFileCount':case'minFileSize':case'maxFileSize':case'maxFilePreviewSize':case'resizeImageQuality':case'resizeIfSizeMoreThan':case'progressUploadThreshold':case'initialPreviewCount':case'zoomModalHeight':case'minImageHeight':case'maxImageHeight':case'minImageWidth':case'maxImageWidth':e[a]=v.getNum(b);break;default:e[a]=b;break}});if(e.rtl){tmp=e.previewZoomButtonIcons.prev;e.previewZoomButtonIcons.prev=e.previewZoomButtonIcons.next;e.previewZoomButtonIcons.next=tmp}if(!d){e._cleanup()}e.$form=$el.closest('form');e._initTemplateDefaults();e.uploadFileAttr=!v.isEmpty($el.attr('name'))?$el.attr('name'):'file_data';t=e._getLayoutTemplate('progress');e.progressTemplate=t.replace('{class}',e.progressClass);e.progressCompleteTemplate=t.replace('{class}',e.progressCompleteClass);e.progressErrorTemplate=t.replace('{class}',e.progressErrorClass);e.dropZoneEnabled=v.hasDragDropSupport()&&e.dropZoneEnabled&&v.canAssignFilesToInput();e.isDisabled=$el.attr('disabled')||$el.attr('readonly');if(e.isDisabled){$el.attr('disabled',true)}e.isAjaxUpload=v.hasFileUploadSupport()&&!v.isEmpty(e.uploadUrl);e.isClickable=e.browseOnZoneClick&&e.showPreview&&(e.dropZoneEnabled||!v.isEmpty(e.defaultPreviewContent));e.slug=typeof c.slugCallback==="function"?c.slugCallback:e._slugDefault;e.mainTemplate=e.showCaption?e._getLayoutTemplate('main1'):e._getLayoutTemplate('main2');e.captionTemplate=e._getLayoutTemplate('caption');e.previewGenericTemplate=e._getPreviewTemplate('generic');if(!e.imageCanvas&&e.resizeImage&&(e.maxImageWidth||e.maxImageHeight)){e.imageCanvas=document.createElement('canvas');e.imageCanvasContext=e.imageCanvas.getContext('2d')}if(v.isEmpty($el.attr('id'))){$el.attr('id',v.uniqId())}e.namespace='.fileinput_'+$el.attr('id').replace(/-/g,'_');if(e.$container===undefined){e.$container=e._createContainer()}else{e._refreshContainer()}$cont=e.$container;e.$dropZone=$cont.find('.file-drop-zone');e.$progress=$cont.find('.kv-upload-progress');e.$btnUpload=$cont.find('.fileinput-upload');e.$captionContainer=v.getElement(c,'elCaptionContainer',$cont.find('.file-caption'));e.$caption=v.getElement(c,'elCaptionText',$cont.find('.file-caption-name'));if(!v.isEmpty(e.msgPlaceholder)){f=$el.attr('multiple')?e.filePlural:e.fileSingle;e.$caption.attr('placeholder',e.msgPlaceholder.replace('{files}',f))}e.$captionIcon=e.$captionContainer.find('.file-caption-icon');e.$previewContainer=v.getElement(c,'elPreviewContainer',$cont.find('.file-preview'));e.$preview=v.getElement(c,'elPreviewImage',$cont.find('.file-preview-thumbnails'));e.$previewStatus=v.getElement(c,'elPreviewStatus',$cont.find('.file-preview-status'));e.$errorContainer=v.getElement(c,'elErrorContainer',e.$previewContainer.find('.kv-fileinput-error'));e._validateDisabled();if(!v.isEmpty(e.msgErrorClass)){v.addCss(e.$errorContainer,e.msgErrorClass)}if(!d){e.$errorContainer.hide();e.previewInitId="preview-"+v.uniqId();e._initPreviewCache();e._initPreview(true);e._initPreviewActions();if(e.$parent.hasClass('file-loading')){e.$container.insertBefore(e.$parent);e.$parent.remove()}}else{if(!e._errorsExist()){e.$errorContainer.hide()}}e._setFileDropZoneTitle();if($el.attr('disabled')){e.disable()}e._initZoom();if(e.hideThumbnailContent){v.addCss(e.$preview,'hide-content')}},_initTemplateDefaults:function(){var c=this,tMain1,tMain2,tPreview,tFileIcon,tClose,tCaption,tBtnDefault,tBtnLink,tBtnBrowse,tModalMain,tModal,tProgress,tSize,tFooter,tActions,tActionDelete,tActionUpload,tActionDownload,tActionZoom,tActionDrag,tIndicator,tTagBef,tTagBef1,tTagBef2,tTagAft,tGeneric,tHtml,tImage,tText,tOffice,tGdocs,tVideo,tAudio,tFlash,tObject,tPdf,tOther,tStyle,tZoomCache,vDefaultDim;tMain1='{preview}\n'+'<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n'+'<div class="input-group {class}">\n'+'  {caption}\n'+'<div class="input-group-btn input-group-append">\n'+'      {remove}\n'+'      {cancel}\n'+'      {upload}\n'+'      {browse}\n'+'    </div>\n'+'</div>';tMain2='{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n';tPreview='<div class="file-preview {class}">\n'+'    {close}'+'    <div class="{dropClass}">\n'+'    <div class="file-preview-thumbnails">\n'+'    </div>\n'+'    <div class="clearfix"></div>'+'    <div class="file-preview-status text-center text-success"></div>\n'+'    <div class="kv-fileinput-error"></div>\n'+'    </div>\n'+'</div>';tClose=v.closeButton('fileinput-remove');tFileIcon='<i class="glyphicon glyphicon-file"></i>';tCaption='<div class="file-caption form-control {class}" tabindex="500">\n'+'  <span class="file-caption-icon"></span>\n'+'  <input class="file-caption-name" onkeydown="return false;" onpaste="return false;">\n'+'</div>';tBtnDefault='<button type="{type}" tabindex="500" title="{title}" class="{css}" '+'{status}>{icon} {label}</button>';tBtnLink='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>';tBtnBrowse='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>';tModalMain='<div id="'+v.MODAL_ID+'" class="file-zoom-dialog modal fade" '+'tabindex="-1" aria-labelledby="'+v.MODAL_ID+'Label"></div>';tModal='<div class="modal-dialog modal-lg{rtl}" role="document">\n'+'  <div class="modal-content">\n'+'    <div class="modal-header">\n'+'      <h5 class="modal-title">{heading}</h5>\n'+'      <span class="kv-zoom-title"></span>\n'+'      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n'+'    </div>\n'+'    <div class="modal-body">\n'+'      <div class="floating-buttons"></div>\n'+'      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n'+'{prev} {next}\n'+'    </div>\n'+'  </div>\n'+'</div>\n';tProgress='<div class="progress">\n'+'    <div class="{class}" role="progressbar"'+' aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n'+'        {status}\n'+'     </div>\n'+'</div>';tSize=' <samp>({sizeText})</samp>';tFooter='<div class="file-thumbnail-footer">\n'+'    <div class="file-footer-caption" title="{caption}">\n'+'        <div class="file-caption-info">{caption}</div>\n'+'        <div class="file-size-info">{size}</div>\n'+'    </div>\n'+'    {progress}\n{indicator}\n{actions}\n'+'</div>';tActions='<div class="file-actions">\n'+'    <div class="file-footer-buttons">\n'+'        {download} {upload} {delete} {zoom} {other}'+'    </div>\n'+'</div>\n'+'{drag}\n'+'<div class="clearfix"></div>';tActionDelete='<button type="button" class="kv-file-remove {removeClass}" '+'title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n';tActionUpload='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">'+'{uploadIcon}</button>';tActionDownload='<a class="kv-file-download {downloadClass}" title="{downloadTitle}" '+'href="{downloadUrl}" download="{caption}" target="_blank">{downloadIcon}</a>';tActionZoom='<button type="button" class="kv-file-zoom {zoomClass}" '+'title="{zoomTitle}">{zoomIcon}</button>';tActionDrag='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>';tIndicator='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>';tTagBef='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}"'+' data-template="{template}"';tTagBef1=tTagBef+'><div class="kv-file-content">\n';tTagBef2=tTagBef+' title="{caption}"><div class="kv-file-content">\n';tTagAft='</div>{footer}\n</div>\n';tGeneric='{content}\n';tStyle=' {style}';tHtml='<div class="kv-preview-data file-preview-html" title="{caption}"'+tStyle+'>{data}</div>\n';tImage='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" '+'alt="{caption}"'+tStyle+'>\n';tText='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly'+tStyle+'>'+'{data}</textarea>\n';tOffice='<iframe class="kv-preview-data file-preview-office" '+'src="https://view.officeapps.live.com/op/embed.aspx?src={data}"'+tStyle+'></iframe>';tGdocs='<iframe class="kv-preview-data file-preview-gdocs" '+'src="https://docs.google.com/gview?url={data}&embedded=true"'+tStyle+'></iframe>';tVideo='<video class="kv-preview-data file-preview-video" controls'+tStyle+'>\n'+'<source src="{data}" type="{type}">\n'+v.DEFAULT_PREVIEW+'\n</video>\n';tAudio='<!--suppress ALL --><audio class="kv-preview-data file-preview-audio" controls'+tStyle+'>\n<source src="{data}" '+'type="{type}">\n'+v.DEFAULT_PREVIEW+'\n</audio>\n';tFlash='<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash"'+tStyle+'>\n';tPdf='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf"'+tStyle+'>\n';tObject='<object class="kv-preview-data file-preview-object file-object {typeCss}" '+'data="{data}" type="{type}"'+tStyle+'>\n'+'<param name="movie" value="{caption}" />\n'+v.OBJECT_PARAMS+' '+v.DEFAULT_PREVIEW+'\n</object>\n';tOther='<div class="kv-preview-data file-preview-other-frame"'+tStyle+'>\n'+v.DEFAULT_PREVIEW+'\n</div>\n';tZoomCache='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>';vDefaultDim={width:"100%",height:"100%",'min-height':"480px"};c.defaults={layoutTemplates:{main1:tMain1,main2:tMain2,preview:tPreview,close:tClose,fileIcon:tFileIcon,caption:tCaption,modalMain:tModalMain,modal:tModal,progress:tProgress,size:tSize,footer:tFooter,indicator:tIndicator,actions:tActions,actionDelete:tActionDelete,actionUpload:tActionUpload,actionDownload:tActionDownload,actionZoom:tActionZoom,actionDrag:tActionDrag,btnDefault:tBtnDefault,btnLink:tBtnLink,btnBrowse:tBtnBrowse,zoomCache:tZoomCache},previewMarkupTags:{tagBefore1:tTagBef1,tagBefore2:tTagBef2,tagAfter:tTagAft},previewContentTemplates:{generic:tGeneric,html:tHtml,image:tImage,text:tText,office:tOffice,gdocs:tGdocs,video:tVideo,audio:tAudio,flash:tFlash,object:tObject,pdf:tPdf,other:tOther},allowedPreviewTypes:['image','html','text','video','audio','flash','pdf','object'],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto",'max-width':"100%",'max-height':"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},office:{width:"213px",height:"160px"},gdocs:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"213px",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto",'max-width':"100%",'max-height':"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},office:{width:"100%",height:"160px"},gdocs:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto",'max-width':"100%",'max-height':"100%"},html:vDefaultDim,text:vDefaultDim,office:{width:"100%",height:"100%",'max-width':"100%",'min-height':"480px"},gdocs:{width:"100%",height:"100%",'max-width':"100%",'min-height':"480px"},video:{width:"auto",height:"100%",'max-width':"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%",'max-width':"100%",'min-height':"480px"},pdf:vDefaultDim,other:{width:"auto",height:"100%",'min-height':"480px"}},fileTypeSettings:{image:function(a,b){return(v.compare(a,'image.*')&&!v.compare(a,/(tiff?|wmf)$/i)||v.compare(b,/\.(gif|png|jpe?g)$/i))},html:function(a,b){return v.compare(a,'text/html')||v.compare(b,/\.(htm|html)$/i)},office:function(a,b){return v.compare(a,/(word|excel|powerpoint|office)$/i)||v.compare(b,/\.(docx?|xlsx?|pptx?|pps|potx?)$/i)},gdocs:function(a,b){return v.compare(a,/(word|excel|powerpoint|office|iwork-pages|tiff?)$/i)||v.compare(b,/\.(docx?|xlsx?|pptx?|pps|potx?|rtf|ods|odt|pages|ai|dxf|ttf|tiff?|wmf|e?ps)$/i)},text:function(a,b){return v.compare(a,'text.*')||v.compare(b,/\.(xml|javascript)$/i)||v.compare(b,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(a,b){return v.compare(a,'video.*')&&(v.compare(a,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||v.compare(b,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(a,b){return v.compare(a,'audio.*')&&(v.compare(b,/(ogg|mp3|mp?g|wav)$/i)||v.compare(b,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(a,b){return v.compare(a,'application/x-shockwave-flash',true)||v.compare(b,/\.(swf)$/i)},pdf:function(a,b){return v.compare(a,'application/pdf',true)||v.compare(b,/\.(pdf)$/i)},object:function(){return true},other:function(){return true}},fileActionSettings:{showRemove:true,showUpload:true,showDownload:true,showZoom:true,showDrag:true,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:'btn btn-sm btn-kv btn-default btn-outline-secondary',removeErrorClass:'btn btn-sm btn-kv btn-danger',removeTitle:'Remove file',uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:'btn btn-sm btn-kv btn-default btn-outline-secondary',uploadTitle:'Upload file',uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:'Retry upload',downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:'btn btn-sm btn-kv btn-default btn-outline-secondary',downloadTitle:'Download file',zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:'btn btn-sm btn-kv btn-default btn-outline-secondary',zoomTitle:'View Details',dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:'text-info',dragTitle:'Move / Rearrange',dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorNewTitle:'Not uploaded yet',indicatorSuccessTitle:'Uploaded',indicatorErrorTitle:'Upload Error',indicatorLoadingTitle:'Uploading ...'}};$.each(c.defaults,function(a,b){if(a==='allowedPreviewTypes'){if(c.allowedPreviewTypes===undefined){c.allowedPreviewTypes=b}return}c[a]=$.extend(true,{},b,c[a])});c._initPreviewTemplates()},_initPreviewTemplates:function(){var c=this,cfg=c.defaults,tags=c.previewMarkupTags,tagBef,tagAft=tags.tagAfter;$.each(cfg.previewContentTemplates,function(a,b){if(v.isEmpty(c.previewTemplates[a])){tagBef=tags.tagBefore2;if(a==='generic'||a==='image'||a==='html'||a==='text'){tagBef=tags.tagBefore1}c.previewTemplates[a]=tagBef+b+tagAft}})},_initPreviewCache:function(){var l=this;l.previewCache={data:{},init:function(){var a=l.initialPreview;if(a.length>0&&!v.isArray(a)){a=a.split(l.initialPreviewDelimiter)}l.previewCache.data={content:a,config:l.initialPreviewConfig,tags:l.initialPreviewThumbTags}},count:function(){return!!l.previewCache.data&&!!l.previewCache.data.content?l.previewCache.data.content.length:0},get:function(i,j){var k='init_'+i,data=l.previewCache.data,config=data.config[i],content=data.content[i],previewId=l.previewInitId+'-'+k,out,$tmp,cat,ftr,fname,ftype,frameClass,asData=v.ifSet('previewAsData',config,l.initialPreviewAsData),parseTemplate=function(a,b,c,d,e,f,g,h,t){h=' file-preview-initial '+v.SORT_CSS+(h?' '+h:'');return l._generatePreviewTemplate(a,b,c,d,e,false,null,h,f,g,t)};if(!content){return''}j=j===undefined?true:j;cat=v.ifSet('type',config,l.initialPreviewFileType||'generic');fname=v.ifSet('filename',config,v.ifSet('caption',config));ftype=v.ifSet('filetype',config,cat);ftr=l.previewCache.footer(i,j,(config&&config.size||null));frameClass=v.ifSet('frameClass',config);if(asData){out=parseTemplate(cat,content,fname,ftype,previewId,ftr,k,frameClass)}else{out=parseTemplate('generic',content,fname,ftype,previewId,ftr,k,frameClass,cat).setTokens({'content':data.content[i]})}if(data.tags.length&&data.tags[i]){out=v.replaceTags(out,data.tags[i])}if(!v.isEmpty(config)&&!v.isEmpty(config.frameAttr)){$tmp=$(document.createElement('div')).html(out);$tmp.find('.file-preview-initial').attr(config.frameAttr);out=$tmp.html();$tmp.remove()}return out},add:function(a,b,c,d){var e=l.previewCache.data,index;if(!v.isArray(a)){a=a.split(l.initialPreviewDelimiter)}if(d){index=e.content.push(a)-1;e.config[index]=b;e.tags[index]=c}else{index=a.length-1;e.content=a;e.config=b;e.tags=c}l.previewCache.data=e;return index},set:function(a,b,c,d){var e=l.previewCache.data,i,chk;if(!a||!a.length){return}if(!v.isArray(a)){a=a.split(l.initialPreviewDelimiter)}chk=a.filter(function(n){return n!==null});if(!chk.length){return}if(e.content===undefined){e.content=[]}if(e.config===undefined){e.config=[]}if(e.tags===undefined){e.tags=[]}if(d){for(i=0;i<a.length;i++){if(a[i]){e.content.push(a[i])}}for(i=0;i<b.length;i++){if(b[i]){e.config.push(b[i])}}for(i=0;i<c.length;i++){if(c[i]){e.tags.push(c[i])}}}else{e.content=a;e.config=b;e.tags=c}l.previewCache.data=e},unset:function(a){var b=l.previewCache.count(),rev=l.reversePreviewOrder;if(!b){return}if(b===1){l.previewCache.data.content=[];l.previewCache.data.config=[];l.previewCache.data.tags=[];l.initialPreview=[];l.initialPreviewConfig=[];l.initialPreviewThumbTags=[];return}l.previewCache.data.content=v.spliceArray(l.previewCache.data.content,a,rev);l.previewCache.data.config=v.spliceArray(l.previewCache.data.config,a,rev);l.previewCache.data.tags=v.spliceArray(l.previewCache.data.tags,a,rev)},out:function(){var a='',caption,len=l.previewCache.count(),i,content;if(len===0){return{content:'',caption:''}}for(i=0;i<len;i++){content=l.previewCache.get(i);a=l.reversePreviewOrder?(content+a):(a+content)}caption=l._getMsgSelected(len);return{content:a,caption:caption}},footer:function(i,b,c){var d=l.previewCache.data||{};if(v.isEmpty(d.content)){return''}if(v.isEmpty(d.config)||v.isEmpty(d.config[i])){d.config[i]={}}b=b===undefined?true:b;var e=d.config[i],caption=v.ifSet('caption',e),a,width=v.ifSet('width',e,'auto'),url=v.ifSet('url',e,false),key=v.ifSet('key',e,null),fs=l.fileActionSettings,initPreviewShowDel=l.initialPreviewShowDelete||false,dUrl=e.downloadUrl||l.initialPreviewDownloadUrl||'',dFil=e.filename||e.caption||'',initPreviewShowDwl=!!(dUrl),sDel=v.ifSet('showRemove',e,v.ifSet('showRemove',fs,initPreviewShowDel)),sDwl=v.ifSet('showDownload',e,v.ifSet('showDownload',fs,initPreviewShowDwl)),sZm=v.ifSet('showZoom',e,v.ifSet('showZoom',fs,true)),sDrg=v.ifSet('showDrag',e,v.ifSet('showDrag',fs,true)),dis=(url===false)&&b;sDwl=sDwl&&e.downloadUrl!==false&&!!dUrl;a=l._renderFileActions(false,sDwl,sDel,sZm,sDrg,dis,url,key,true,dUrl,dFil);return l._getLayoutTemplate('footer').setTokens({'progress':l._renderThumbProgress(),'actions':a,'caption':caption,'size':l._getSize(c),'width':width,'indicator':''})}};l.previewCache.init()},_handler:function(a,b,c){var d=this,ns=d.namespace,ev=b.split(' ').join(ns+' ')+ns;if(!a||!a.length){return}a.off(ev).on(ev,c)},_log:function(a){var b=this,id=b.$element.attr('id');if(id){a='"'+id+'": '+a}if(typeof window.console.log!=="undefined"){window.console.log(a)}else{window.alert(a)}},_validate:function(){var a=this,status=a.$element.attr('type')==='file';if(!status){a._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.')}return status},_errorsExist:function(){var a=this,$err,$errList=a.$errorContainer.find('li');if($errList.length){return true}$err=$(document.createElement('div')).html(a.$errorContainer.html());$err.find('.kv-error-close').remove();$err.find('ul').remove();return!!$.trim($err.text()).length},_errorHandler:function(b,c){var d=this,err=b.target.error,showError=function(a){d._showError(a.replace('{name}',c))};if(err.code===err.NOT_FOUND_ERR){showError(d.msgFileNotFound)}else if(err.code===err.SECURITY_ERR){showError(d.msgFileSecured)}else if(err.code===err.NOT_READABLE_ERR){showError(d.msgFileNotReadable)}else if(err.code===err.ABORT_ERR){showError(d.msgFilePreviewAborted)}else{showError(d.msgFilePreviewError)}},_addError:function(a){var b=this,$error=b.$errorContainer;if(a&&$error.length){$error.html(b.errorCloseButton+a);b._handler($error.find('.kv-error-close'),'click',function(){setTimeout(function(){if(b.showPreview&&!b.getFrames().length){b.clear()}$error.fadeOut('slow')},10)})}},_setValidationError:function(a){var b=this;a=(a?a+' ':'')+'has-error';b.$container.removeClass(a).addClass('has-error');v.addCss(b.$captionContainer,'is-invalid')},_resetErrors:function(a){var b=this,$error=b.$errorContainer;b.isError=false;b.$container.removeClass('has-error');b.$captionContainer.removeClass('is-invalid');$error.html('');if(a){$error.fadeOut('slow')}else{$error.hide()}},_showFolderError:function(a){var b=this,$error=b.$errorContainer,msg;if(!a){return}if(!b.isAjaxUpload){b._clearFileInput()}msg=b.msgFoldersNotAllowed.replace('{n}',a);b._addError(msg);b._setValidationError();$error.fadeIn(800);b._raise('filefoldererror',[a,msg])},_showUploadError:function(a,b,c){var d=this,$error=d.$errorContainer,ev=c||'fileuploaderror',e=b&&b.id?'<li data-file-id="'+b.id+'">'+a+'</li>':'<li>'+a+'</li>';if($error.find('ul').length===0){d._addError('<ul>'+e+'</ul>')}else{$error.find('ul').append(e)}$error.fadeIn(800);d._raise(ev,[b,a]);d._setValidationError('file-input-new');return true},_showError:function(a,b,c){var d=this,$error=d.$errorContainer,ev=c||'fileerror';b=b||{};b.reader=d.reader;d._addError(a);$error.fadeIn(800);d._raise(ev,[b,a]);if(!d.isAjaxUpload){d._clearFileInput()}d._setValidationError('file-input-new');d.$btnUpload.attr('disabled',true);return true},_noFilesError:function(a){var b=this,label=b.minFileCount>1?b.filePlural:b.fileSingle,msg=b.msgFilesTooLess.replace('{n}',b.minFileCount).replace('{files}',label),$error=b.$errorContainer;b._addError(msg);b.isError=true;b._updateFileDetails(0);$error.fadeIn(800);b._raise('fileerror',[a,msg]);b._clearFileInput();b._setValidationError()},_parseError:function(a,b,c,d){var e=this,errMsg=$.trim(c+''),textPre,text=b.responseJSON!==undefined&&b.responseJSON.error!==undefined?b.responseJSON.error:b.responseText;if(e.cancelling&&e.msgUploadAborted){errMsg=e.msgUploadAborted}if(e.showAjaxErrorDetails&&text){text=$.trim(text.replace(/\n\s*\n/g,'\n'));textPre=text.length?'<pre>'+text+'</pre>':'';errMsg+=errMsg?textPre:text}if(!errMsg){errMsg=e.msgAjaxError.replace('{operation}',a)}e.cancelling=false;return d?'<b>'+d+': </b>'+errMsg:errMsg},_parseFileType:function(a,b){var c=this,isValid,vType,cat,i,types=c.allowedPreviewTypes||[];if(a==='application/text-plain'){return'text'}for(i=0;i<types.length;i++){cat=types[i];isValid=c.fileTypeSettings[cat];vType=isValid(a,b)?cat:'';if(!v.isEmpty(vType)){return vType}}return'other'},_getPreviewIcon:function(c){var d=this,ext,out=null;if(c&&c.indexOf('.')>-1){ext=c.split('.').pop();if(d.previewFileIconSettings){out=d.previewFileIconSettings[ext]||d.previewFileIconSettings[ext.toLowerCase()]||null}if(d.previewFileExtSettings){$.each(d.previewFileExtSettings,function(a,b){if(d.previewFileIconSettings[a]&&b(ext)){out=d.previewFileIconSettings[a];return}})}}return out},_parseFilePreviewIcon:function(a,b){var c=this,icn=c._getPreviewIcon(b)||c.previewFileIcon,out=a;if(out.indexOf('{previewFileIcon}')>-1){out=out.setTokens({'previewFileIconClass':c.previewFileIconClass,'previewFileIcon':icn})}return out},_raise:function(a,b){var c=this,e=$.Event(a);if(b!==undefined){c.$element.trigger(e,b)}else{c.$element.trigger(e)}if(e.isDefaultPrevented()||e.result===false){return false}switch(a){case'filebatchuploadcomplete':case'filebatchuploadsuccess':case'fileuploaded':case'fileclear':case'filecleared':case'filereset':case'fileerror':case'filefoldererror':case'fileuploaderror':case'filebatchuploaderror':case'filedeleteerror':case'filecustomerror':case'filesuccessremove':break;default:if(!c.ajaxAborted){c.ajaxAborted=e.result}break}return true},_listenFullScreen:function(a){var b=this,$modal=b.$modal,$btnFull,$btnBord;if(!$modal||!$modal.length){return}$btnFull=$modal&&$modal.find('.btn-fullscreen');$btnBord=$modal&&$modal.find('.btn-borderless');if(!$btnFull.length||!$btnBord.length){return}$btnFull.removeClass('active').attr('aria-pressed','false');$btnBord.removeClass('active').attr('aria-pressed','false');if(a){$btnFull.addClass('active').attr('aria-pressed','true')}else{$btnBord.addClass('active').attr('aria-pressed','true')}if($modal.hasClass('file-zoom-fullscreen')){b._maximizeZoomDialog()}else{if(a){b._maximizeZoomDialog()}else{$btnBord.removeClass('active').attr('aria-pressed','false')}}},_listen:function(){var a=this,$el=a.$element,$form=a.$form,$cont=a.$container,fullScreenEvents;a._handler($el,'change',$.proxy(a._change,a));if(a.showBrowse){a._handler(a.$btnFile,'click',$.proxy(a._browse,a))}a._handler($cont.find('.fileinput-remove:not([disabled])'),'click',$.proxy(a.clear,a));a._handler($cont.find('.fileinput-cancel'),'click',$.proxy(a.cancel,a));a._initDragDrop();a._handler($form,'reset',$.proxy(a.clear,a));if(!a.isAjaxUpload){a._handler($form,'submit',$.proxy(a._submitForm,a))}a._handler(a.$container.find('.fileinput-upload'),'click',$.proxy(a._uploadClick,a));a._handler($(window),'resize',function(){a._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});fullScreenEvents='webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange';a._handler($(document),fullScreenEvents,function(){a._listenFullScreen(v.checkFullScreen())});a._autoFitContent();a._initClickable()},_autoFitContent:function(){var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,self=this,config=c<400?(self.previewSettingsSmall||self.defaults.previewSettingsSmall):(self.previewSettings||self.defaults.previewSettings),sel;$.each(config,function(a,b){sel='.file-preview-frame .file-preview-'+a;self.$preview.find(sel+'.kv-preview-data,'+sel+' .kv-preview-data').css(b)})},_initClickable:function(){var b=this,$zone;if(!b.isClickable){return}$zone=b.isAjaxUpload?b.$dropZone:b.$preview.find('.file-default-preview');v.addCss($zone,'clickable');$zone.attr('tabindex',-1);b._handler($zone,'click',function(e){var a=$(e.target);if(!$(b.elErrorContainer+':visible').length&&(!a.parents('.file-preview-thumbnails').length||a.parents('.file-default-preview').length)){b.$element.trigger('click');$zone.blur()}})},_scanDroppedItems:function(b,c,d){d=d||"";var f=this,i,dirReader,readDir,errorHandler=function(e){f._log('Error scanning dropped files!');f._log(e)};if(b.isFile){b.file(function(a){c.push(a)},errorHandler)}else{if(b.isDirectory){dirReader=b.createReader();readDir=function(){dirReader.readEntries(function(a){if(a&&a.length>0){for(i=0;i<a.length;i++){f._scanDroppedItems(a[i],c,d+b.name+"/")}readDir()}return null},errorHandler)};readDir()}}},_initDragDrop:function(){var a=this,$zone=a.$dropZone;if(a.dropZoneEnabled&&a.showPreview){a._handler($zone,'dragenter dragover',$.proxy(a._zoneDragEnter,a));a._handler($zone,'dragleave',$.proxy(a._zoneDragLeave,a));a._handler($zone,'drop',$.proxy(a._zoneDrop,a));a._handler($(document),'dragenter dragover drop',a._zoneDragDropInit)}},_zoneDragDropInit:function(e){e.stopPropagation();e.preventDefault()},_zoneDragEnter:function(e){var a=this,hasFiles=$.inArray('Files',e.originalEvent.dataTransfer.types)>-1;a._zoneDragDropInit(e);if(a.isDisabled||!hasFiles){e.originalEvent.dataTransfer.effectAllowed='none';e.originalEvent.dataTransfer.dropEffect='none';return}v.addCss(a.$dropZone,'file-highlighted')},_zoneDragLeave:function(e){var a=this;a._zoneDragDropInit(e);if(a.isDisabled){return}a.$dropZone.removeClass('file-highlighted')},_zoneDrop:function(e){var a=this,i,$el=a.$element,dataTransfer=e.originalEvent.dataTransfer,files=dataTransfer.files,items=dataTransfer.items,folders=v.getDragDropFolders(items),processFiles=function(){if(!a.isAjaxUpload){a.changeTriggered=true;$el.get(0).files=files;setTimeout(function(){a.changeTriggered=false;$el.trigger('change'+a.namespace)},10)}else{a._change(e,files)}a.$dropZone.removeClass('file-highlighted')};e.preventDefault();if(a.isDisabled||v.isEmpty(files)){return}if(folders>0){if(!a.isAjaxUpload){a._showFolderError(folders);return}files=[];for(i=0;i<items.length;i++){var b=items[i].webkitGetAsEntry();if(b){a._scanDroppedItems(b,files)}}setTimeout(function(){processFiles()},500)}else{processFiles()}},_uploadClick:function(e){var a=this,$btn=a.$container.find('.fileinput-upload'),$form,isEnabled=!$btn.hasClass('disabled')&&v.isEmpty($btn.attr('disabled'));if(e&&e.isDefaultPrevented()){return}if(!a.isAjaxUpload){if(isEnabled&&$btn.attr('type')!=='submit'){$form=$btn.closest('form');if($form.length){$form.trigger('submit')}e.preventDefault()}return}e.preventDefault();if(isEnabled){a.upload()}},_submitForm:function(){var a=this;return a._isFileSelectionValid()&&!a._abort({})},_clearPreview:function(){var b=this,$p=b.$preview,$thumbs=b.showUploadedThumbs?b.getFrames(':not(.file-preview-success)'):b.getFrames();$thumbs.each(function(){var a=$(this);a.remove();v.cleanZoomCache($p.find('#zoom-'+a.attr('id')))});if(!b.getFrames().length||!b.showPreview){b._resetUpload()}b._validateDefaultPreview()},_initSortable:function(){var b=this,$el=b.$preview,settings,selector='.'+v.SORT_CSS,rev=b.reversePreviewOrder;if(!window.KvSortable||$el.find(selector).length===0){return}settings={handle:'.drag-handle-init',dataIdAttr:'data-preview-id',scroll:false,draggable:selector,onSort:function(e){var a=e.oldIndex,newIndex=e.newIndex,i=0;b.initialPreview=v.moveArray(b.initialPreview,a,newIndex,rev);b.initialPreviewConfig=v.moveArray(b.initialPreviewConfig,a,newIndex,rev);b.previewCache.init();b.getFrames('.file-preview-initial').each(function(){$(this).attr('data-fileindex','init_'+i);i++});b._raise('filesorted',{previewId:$(e.item).attr('id'),'oldIndex':a,'newIndex':newIndex,stack:b.initialPreviewConfig})}};if($el.data('kvsortable')){$el.kvsortable('destroy')}$.extend(true,settings,b.fileActionSettings.dragSettings);$el.kvsortable(settings)},_setPreviewContent:function(a){var b=this;b.$preview.html(a);b._autoFitContent()},_initPreview:function(a){var b=this,cap=b.initialCaption||'',out;if(!b.previewCache.count()){b._clearPreview();if(a){b._setCaption(cap)}else{b._initCaption()}return}out=b.previewCache.out();cap=a&&b.initialCaption?b.initialCaption:out.caption;b._setPreviewContent(out.content);b._setInitThumbAttr();b._setCaption(cap);b._initSortable();if(!v.isEmpty(out.content)){b.$container.removeClass('file-input-new')}},_getZoomButton:function(a){var b=this,label=b.previewZoomButtonIcons[a],css=b.previewZoomButtonClasses[a],title=' title="'+(b.previewZoomButtonTitles[a]||'')+'" ',params=title+(a==='close'?' data-dismiss="modal" aria-hidden="true"':'');if(a==='fullscreen'||a==='borderless'||a==='toggleheader'){params+=' data-toggle="button" aria-pressed="false" autocomplete="off"'}return'<button type="button" class="'+css+' btn-'+a+'"'+params+'>'+label+'</button>'},_getModalContent:function(){var a=this;return a._getLayoutTemplate('modal').setTokens({'rtl':a.rtl?' kv-rtl':'','zoomFrameClass':a.frameClass,'heading':a.msgZoomModalHeading,'prev':a._getZoomButton('prev'),'next':a._getZoomButton('next'),'toggleheader':a._getZoomButton('toggleheader'),'fullscreen':a._getZoomButton('fullscreen'),'borderless':a._getZoomButton('borderless'),'close':a._getZoomButton('close')})},_listenModalEvent:function(b){var c=this,$modal=c.$modal,getParams=function(e){return{sourceEvent:e,previewId:$modal.data('previewId'),modal:$modal}};$modal.on(b+'.bs.modal',function(e){var a=$modal.find('.btn-fullscreen'),$btnBord=$modal.find('.btn-borderless');c._raise('filezoom'+b,getParams(e));if(b==='shown'){$btnBord.removeClass('active').attr('aria-pressed','false');a.removeClass('active').attr('aria-pressed','false');if($modal.hasClass('file-zoom-fullscreen')){c._maximizeZoomDialog();if(v.checkFullScreen()){a.addClass('active').attr('aria-pressed','true')}else{$btnBord.addClass('active').attr('aria-pressed','true')}}}})},_initZoom:function(){var c=this,$dialog,modalMain=c._getLayoutTemplate('modalMain'),modalId='#'+v.MODAL_ID;if(!c.showPreview){return}c.$modal=$(modalId);if(!c.$modal||!c.$modal.length){$dialog=$(document.createElement('div')).html(modalMain).insertAfter(c.$container);c.$modal=$(modalId).insertBefore($dialog);$dialog.remove()}v.initModal(c.$modal);c.$modal.html(c._getModalContent());$.each(v.MODAL_EVENTS,function(a,b){c._listenModalEvent(b)})},_initZoomButtons:function(){var a=this,previewId=a.$modal.data('previewId')||'',$first,$last,thumbs=a.getFrames().toArray(),len=thumbs.length,$prev=a.$modal.find('.btn-prev'),$next=a.$modal.find('.btn-next');if(thumbs.length<2){$prev.hide();$next.hide();return}else{$prev.show();$next.show()}if(!len){return}$first=$(thumbs[0]);$last=$(thumbs[len-1]);$prev.removeAttr('disabled');$next.removeAttr('disabled');if($first.length&&$first.attr('id')===previewId){$prev.attr('disabled',true)}if($last.length&&$last.attr('id')===previewId){$next.attr('disabled',true)}},_maximizeZoomDialog:function(){var a=this,$modal=a.$modal,$head=$modal.find('.modal-header:visible'),$foot=$modal.find('.modal-footer:visible'),$body=$modal.find('.modal-body'),h=$(window).height(),diff=0;$modal.addClass('file-zoom-fullscreen');if($head&&$head.length){h-=$head.outerHeight(true)}if($foot&&$foot.length){h-=$foot.outerHeight(true)}if($body&&$body.length){diff=$body.outerHeight(true)-$body.height();h-=diff}$modal.find('.kv-zoom-body').height(h)},_resizeZoomDialog:function(a){var b=this,$modal=b.$modal,$btnFull=$modal.find('.btn-fullscreen'),$btnBord=$modal.find('.btn-borderless');if($modal.hasClass('file-zoom-fullscreen')){v.toggleFullScreen(false);if(!a){if(!$btnFull.hasClass('active')){$modal.removeClass('file-zoom-fullscreen');b.$modal.find('.kv-zoom-body').css('height',b.zoomModalHeight)}else{$btnFull.removeClass('active').attr('aria-pressed','false')}}else{if(!$btnFull.hasClass('active')){$modal.removeClass('file-zoom-fullscreen');b._resizeZoomDialog(true);if($btnBord.hasClass('active')){$btnBord.removeClass('active').attr('aria-pressed','false')}}}}else{if(!a){b._maximizeZoomDialog();return}v.toggleFullScreen(true)}$modal.focus()},_setZoomContent:function(d,f){var g=this,$content,tmplt,body,title,$body,$dataEl,config,pid=d.attr('id'),$modal=g.$modal,$prev=$modal.find('.btn-prev'),$next=$modal.find('.btn-next'),$tmp,$btnFull=$modal.find('.btn-fullscreen'),$btnBord=$modal.find('.btn-borderless'),cap,size,$btnTogh=$modal.find('.btn-toggleheader'),$zoomPreview=g.$preview.find('#zoom-'+pid);tmplt=$zoomPreview.attr('data-template')||'generic';$content=$zoomPreview.find('.kv-file-content');body=$content.length?$content.html():'';cap=d.data('caption')||'';size=d.data('size')||'';title=cap+' '+size;$modal.find('.kv-zoom-title').attr('title',$('<div/>').html(title).text()).html(title);$body=$modal.find('.kv-zoom-body');$modal.removeClass('kv-single-content');if(f){$tmp=$body.addClass('file-thumb-loading').clone().insertAfter($body);$body.html(body).hide();$tmp.fadeOut('fast',function(){$body.fadeIn('fast',function(){$body.removeClass('file-thumb-loading')});$tmp.remove()})}else{$body.html(body)}config=g.previewZoomSettings[tmplt];if(config){$dataEl=$body.find('.kv-preview-data');v.addCss($dataEl,'file-zoom-detail');$.each(config,function(a,b){$dataEl.css(a,b);if(($dataEl.attr('width')&&a==='width')||($dataEl.attr('height')&&a==='height')){$dataEl.removeAttr(a)}})}$modal.data('previewId',pid);var i=$body.find('img');if(i.length){v.adjustOrientedImage(i,true)}g._handler($prev,'click',function(){g._zoomSlideShow('prev',pid)});g._handler($next,'click',function(){g._zoomSlideShow('next',pid)});g._handler($btnFull,'click',function(){g._resizeZoomDialog(true)});g._handler($btnBord,'click',function(){g._resizeZoomDialog(false)});g._handler($btnTogh,'click',function(){var c=$modal.find('.modal-header'),$floatBar=$modal.find('.modal-body .floating-buttons'),ht,$actions=c.find('.kv-zoom-actions'),resize=function(a){var b=g.$modal.find('.kv-zoom-body'),h=g.zoomModalHeight;if($modal.hasClass('file-zoom-fullscreen')){h=b.outerHeight(true);if(!a){h=h-c.outerHeight(true)}}b.css('height',a?h+a:h)};if(c.is(':visible')){ht=c.outerHeight(true);c.slideUp('slow',function(){$actions.find('.btn').appendTo($floatBar);resize(ht)})}else{$floatBar.find('.btn').appendTo($actions);c.slideDown('slow',function(){resize()})}$modal.focus()});g._handler($modal,'keydown',function(e){var a=e.which||e.keyCode;if(a===37&&!$prev.attr('disabled')){g._zoomSlideShow('prev',pid)}if(a===39&&!$next.attr('disabled')){g._zoomSlideShow('next',pid)}})},_zoomPreview:function(a){var b=this,$frame,$modal=b.$modal;if(!a.length){throw'Cannot zoom to detailed preview!';}v.initModal($modal);$modal.html(b._getModalContent());$frame=a.closest(v.FRAMES);b._setZoomContent($frame);$modal.modal('show');b._initZoomButtons()},_zoomSlideShow:function(a,b){var c=this,$btn=c.$modal.find('.kv-zoom-actions .btn-'+a),$targFrame,i,thumbs=c.getFrames().toArray(),len=thumbs.length,out;if($btn.attr('disabled')){return}for(i=0;i<len;i++){if($(thumbs[i]).attr('id')===b){out=a==='prev'?i-1:i+1;break}}if(out<0||out>=len||!thumbs[out]){return}$targFrame=$(thumbs[out]);if($targFrame.length){c._setZoomContent($targFrame,true)}c._initZoomButtons();c._raise('filezoom'+a,{'previewId':b,modal:c.$modal})},_initZoomButton:function(){var b=this;b.$preview.find('.kv-file-zoom').each(function(){var a=$(this);b._handler(a,'click',function(){b._zoomPreview(a)})})},_clearObjects:function(a){a.find('video audio').each(function(){this.pause();$(this).remove()});a.find('img object div').each(function(){$(this).remove()})},_clearFileInput:function(){var a=this,$el=a.$element,$srcFrm,$tmpFrm,$tmpEl;if(v.isEmpty($el.files)&&v.isEmpty($el.val())){return}$el.files=null;$srcFrm=$el.closest('form');$tmpFrm=$(document.createElement('form'));$tmpEl=$(document.createElement('div'));$el.before($tmpEl);if($srcFrm.length){$srcFrm.after($tmpFrm)}else{$tmpEl.after($tmpFrm)}$tmpFrm.append($el).trigger('reset');$tmpEl.before($el).remove();$tmpFrm.remove()},_resetUpload:function(){var a=this;a.uploadCache={content:[],config:[],tags:[],append:true};a.uploadCount=0;a.uploadStatus={};a.uploadLog=[];a.uploadAsyncCount=0;a.loadedImages=[];a.totalImagesCount=0;a.$btnUpload.removeAttr('disabled');a._setProgress(0);a.$progress.hide();a._resetErrors(false);a.ajaxAborted=false;a.ajaxRequests=[];a._resetCanvas();a.cacheInitialPreview={};if(a.overwriteInitial){a.initialPreview=[];a.initialPreviewConfig=[];a.initialPreviewThumbTags=[];a.previewCache.data={content:[],config:[],tags:[]}}},_resetCanvas:function(){var a=this;if(a.canvas&&a.imageCanvasContext){a.imageCanvasContext.clearRect(0,0,a.canvas.width,a.canvas.height)}},_hasInitialPreview:function(){var a=this;return!a.overwriteInitial&&a.previewCache.count()},_resetPreview:function(){var a=this,out,cap;if(a.previewCache.count()){out=a.previewCache.out();a._setPreviewContent(out.content);a._setInitThumbAttr();cap=a.initialCaption?a.initialCaption:out.caption;a._setCaption(cap)}else{a._clearPreview();a._initCaption()}if(a.showPreview){a._initZoom();a._initSortable()}},_clearDefaultPreview:function(){var a=this;a.$preview.find('.file-default-preview').remove()},_validateDefaultPreview:function(){var a=this;if(!a.showPreview||v.isEmpty(a.defaultPreviewContent)){return}a._setPreviewContent('<div class="file-default-preview">'+a.defaultPreviewContent+'</div>');a.$container.removeClass('file-input-new');a._initClickable()},_resetPreviewThumbs:function(a){var b=this,out;if(a){b._clearPreview();b.clearStack();return}if(b._hasInitialPreview()){out=b.previewCache.out();b._setPreviewContent(out.content);b._setInitThumbAttr();b._setCaption(out.caption);b._initPreviewActions()}else{b._clearPreview()}},_getLayoutTemplate:function(t){var a=this,template=a.layoutTemplates[t];if(v.isEmpty(a.customLayoutTags)){return template}return v.replaceTags(template,a.customLayoutTags)},_getPreviewTemplate:function(t){var a=this,template=a.previewTemplates[t];if(v.isEmpty(a.customPreviewTags)){return template}return v.replaceTags(template,a.customPreviewTags)},_getOutData:function(a,b,c){var d=this;a=a||{};b=b||{};c=c||d.filestack.slice(0)||{};return{form:d.formdata,files:c,filenames:d.filenames,filescount:d.getFilesCount(),extra:d._getExtraData(),response:b,reader:d.reader,jqXHR:a}},_getMsgSelected:function(n){var a=this,strFiles=n===1?a.fileSingle:a.filePlural;return n>0?a.msgSelected.replace('{n}',n).replace('{files}',strFiles):a.msgNoFilesSelected},_getFrame:function(a){var b=this,$frame=$('#'+a);if(!$frame.length){b._log('Invalid thumb frame with id: "'+a+'".');return null}return $frame},_getThumbs:function(a){a=a||'';return this.getFrames(':not(.file-preview-initial)'+a)},_getExtraData:function(a,b){var c=this,data=c.uploadExtraData;if(typeof c.uploadExtraData==="function"){data=c.uploadExtraData(a,b)}return data},_initXhr:function(c,d,e){var f=this;if(c.upload){c.upload.addEventListener('progress',function(a){var b=0,total=a.total,position=a.loaded||a.position;if(a.lengthComputable){b=Math.floor(position/total*100)}if(d){f._setAsyncUploadStatus(d,b,e)}else{f._setProgress(b)}},false)}return c},_initAjaxSettings:function(){var a=this;a._ajaxSettings=$.extend(true,{},a.ajaxSettings);a._ajaxDeleteSettings=$.extend(true,{},a.ajaxDeleteSettings)},_mergeAjaxCallback:function(a,b,c){var d=this,settings=d._ajaxSettings,flag=d.mergeAjaxCallbacks,targFunc;if(c==='delete'){settings=d._ajaxDeleteSettings;flag=d.mergeAjaxDeleteCallbacks}targFunc=settings[a];if(flag&&typeof targFunc==="function"){if(flag==='before'){settings[a]=function(){targFunc.apply(this,arguments);b.apply(this,arguments)}}else{settings[a]=function(){b.apply(this,arguments);targFunc.apply(this,arguments)}}}else{settings[a]=b}},_ajaxSubmit:function(b,c,d,e,f,g){var h=this,settings;if(!h._raise('filepreajax',[f,g])){return}h._uploadExtra(f,g);h._initAjaxSettings();h._mergeAjaxCallback('beforeSend',b);h._mergeAjaxCallback('success',c);h._mergeAjaxCallback('complete',d);h._mergeAjaxCallback('error',e);settings=$.extend(true,{},{xhr:function(){var a=$.ajaxSettings.xhr();return h._initXhr(a,f,h.getFileStack().length)},url:g&&h.uploadUrlThumb?h.uploadUrlThumb:h.uploadUrl,type:'POST',dataType:'json',data:h.formdata,cache:false,processData:false,contentType:false},h._ajaxSettings);h.ajaxRequests.push($.ajax(settings))},_mergeArray:function(a,b){var c=this,arr1=v.cleanArray(c[a]),arr2=v.cleanArray(b);c[a]=arr1.concat(arr2)},_initUploadSuccess:function(b,c,d){var e=this,append,data,index,$div,$newCache,content,config,tags,i;if(!e.showPreview||typeof b!=='object'||$.isEmptyObject(b)){return}if(b.initialPreview!==undefined&&b.initialPreview.length>0){e.hasInitData=true;content=b.initialPreview||[];config=b.initialPreviewConfig||[];tags=b.initialPreviewThumbTags||[];append=b.append===undefined||b.append;if(content.length>0&&!v.isArray(content)){content=content.split(e.initialPreviewDelimiter)}e._mergeArray('initialPreview',content);e._mergeArray('initialPreviewConfig',config);e._mergeArray('initialPreviewThumbTags',tags);if(c!==undefined){if(!d){index=e.previewCache.add(content,config[0],tags[0],append);data=e.previewCache.get(index,false);$div=$(document.createElement('div')).html(data).hide().insertAfter(c);$newCache=$div.find('.kv-zoom-cache');if($newCache&&$newCache.length){$newCache.insertAfter(c)}c.fadeOut('slow',function(){var a=$div.find('.file-preview-frame');if(a&&a.length){a.insertBefore(c).fadeIn('slow').css('display:inline-block')}e._initPreviewActions();e._clearFileInput();v.cleanZoomCache(e.$preview.find('#zoom-'+c.attr('id')));c.remove();$div.remove();e._initSortable()})}else{i=c.attr('data-fileindex');e.uploadCache.content[i]=content[0];e.uploadCache.config[i]=config[0]||[];e.uploadCache.tags[i]=tags[0]||[];e.uploadCache.append=append}}else{e.previewCache.set(content,config,tags,append);e._initPreview();e._initPreviewActions()}}},_initSuccessThumbs:function(){var c=this;if(!c.showPreview){return}c._getThumbs(v.FRAMES+'.file-preview-success').each(function(){var b=$(this),$preview=c.$preview,$remove=b.find('.kv-file-remove');$remove.removeAttr('disabled');c._handler($remove,'click',function(){var a=b.attr('id'),out=c._raise('filesuccessremove',[a,b.attr('data-fileindex')]);v.cleanMemory(b);if(out===false){return}b.fadeOut('slow',function(){v.cleanZoomCache($preview.find('#zoom-'+a));b.remove();if(!c.getFrames().length){c.reset()}})})})},_checkAsyncComplete:function(){var a=this,previewId,i;for(i=0;i<a.filestack.length;i++){if(a.filestack[i]){previewId=a.previewInitId+"-"+i;if($.inArray(previewId,a.uploadLog)===-1){return false}}}return(a.uploadAsyncCount===a.uploadLog.length)},_uploadExtra:function(c,d){var e=this,data=e._getExtraData(c,d);if(data.length===0){return}$.each(data,function(a,b){e.formdata.append(a,b)})},_uploadSingle:function(i,e){var f=this,total=f.getFileStack().length,formdata=new FormData(),outData,previewId=f.previewInitId+"-"+i,$thumb,chkComplete,$btnUpload,$btnDelete,hasPostData=f.filestack.length>0||!$.isEmptyObject(f.uploadExtraData),uploadFailed,$prog=$('#'+previewId).find('.file-thumb-progress'),fnBefore,fnSuccess,fnComplete,fnError,updateUploadLog,params={id:previewId,index:i};f.formdata=formdata;if(f.showPreview){$thumb=$('#'+previewId+':not(.file-preview-initial)');$btnUpload=$thumb.find('.kv-file-upload');$btnDelete=$thumb.find('.kv-file-remove');$prog.show()}if(total===0||!hasPostData||($btnUpload&&$btnUpload.hasClass('disabled'))||f._abort(params)){return}updateUploadLog=function(i,a){if(!uploadFailed){f.updateStack(i,undefined)}f.uploadLog.push(a);if(f._checkAsyncComplete()){f.fileBatchCompleted=true}};chkComplete=function(){var u=f.uploadCache,$initThumbs,i,j,len=0,data=f.cacheInitialPreview;if(!f.fileBatchCompleted){return}if(data&&data.content){len=data.content.length}setTimeout(function(){var a=f.getFileStack(true).length===0;if(f.showPreview){f.previewCache.set(u.content,u.config,u.tags,u.append);if(len){for(i=0;i<u.content.length;i++){j=i+len;data.content[j]=u.content[i];if(data.config.length){data.config[j]=u.config[i]}if(data.tags.length){data.tags[j]=u.tags[i]}}f.initialPreview=v.cleanArray(data.content);f.initialPreviewConfig=v.cleanArray(data.config);f.initialPreviewThumbTags=v.cleanArray(data.tags)}else{f.initialPreview=u.content;f.initialPreviewConfig=u.config;f.initialPreviewThumbTags=u.tags}f.cacheInitialPreview={};if(f.hasInitData){f._initPreview();f._initPreviewActions()}}f.unlock(a);if(a){f._clearFileInput()}$initThumbs=f.$preview.find('.file-preview-initial');if(f.uploadAsync&&$initThumbs.length){v.addCss($initThumbs,v.SORT_CSS);f._initSortable()}f._raise('filebatchuploadcomplete',[f.filestack,f._getExtraData()]);f.uploadCount=0;f.uploadStatus={};f.uploadLog=[];f._setProgress(101);f.ajaxAborted=false},100)};fnBefore=function(a){outData=f._getOutData(a);f.fileBatchCompleted=false;if(!e){f.ajaxAborted=false}if(f.showPreview){if(!$thumb.hasClass('file-preview-success')){f._setThumbStatus($thumb,'Loading');v.addCss($thumb,'file-uploading')}$btnUpload.attr('disabled',true);$btnDelete.attr('disabled',true)}if(!e){f.lock()}f._raise('filepreupload',[outData,previewId,i]);$.extend(true,params,outData);if(f._abort(params)){a.abort();if(!e){f._setThumbStatus($thumb,'New');$thumb.removeClass('file-uploading');$btnUpload.removeAttr('disabled');$btnDelete.removeAttr('disabled');f.unlock()}f._setProgressCancelled()}};fnSuccess=function(a,b,c){var d=f.showPreview&&$thumb.attr('id')?$thumb.attr('id'):previewId;outData=f._getOutData(c,a);$.extend(true,params,outData);setTimeout(function(){if(v.isEmpty(a)||v.isEmpty(a.error)){if(f.showPreview){f._setThumbStatus($thumb,'Success');$btnUpload.hide();f._initUploadSuccess(a,$thumb,e);f._setProgress(101,$prog)}f._raise('fileuploaded',[outData,d,i]);if(!e){f.updateStack(i,undefined)}else{updateUploadLog(i,d)}}else{uploadFailed=true;f._showUploadError(a.error,params);f._setPreviewError($thumb,i,f.filestack[i],f.retryErrorUploads);if(!f.retryErrorUploads){$btnUpload.hide()}if(e){updateUploadLog(i,d)}f._setProgress(101,$('#'+d).find('.file-thumb-progress'),f.msgUploadError)}},100)};fnComplete=function(){setTimeout(function(){if(f.showPreview){$btnUpload.removeAttr('disabled');$btnDelete.removeAttr('disabled');$thumb.removeClass('file-uploading')}if(!e){f.unlock(false);f._clearFileInput()}else{chkComplete()}f._initSuccessThumbs()},100)};fnError=function(a,b,c){var d=f.ajaxOperations.uploadThumb,errMsg=f._parseError(d,a,c,(e&&f.filestack[i].name?f.filestack[i].name:null));uploadFailed=true;setTimeout(function(){if(e){updateUploadLog(i,previewId)}f.uploadStatus[previewId]=100;f._setPreviewError($thumb,i,f.filestack[i],f.retryErrorUploads);if(!f.retryErrorUploads){$btnUpload.hide()}$.extend(true,params,f._getOutData(a));f._setProgress(101,$prog,f.msgAjaxProgressError.replace('{operation}',d));f._setProgress(101,$('#'+previewId).find('.file-thumb-progress'),f.msgUploadError);f._showUploadError(errMsg,params)},100)};formdata.append(f.uploadFileAttr,f.filestack[i],f.filenames[i]);formdata.append('file_id',i);f._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError,previewId,i)},_uploadBatch:function(){var f=this,files=f.filestack,total=files.length,params={},fnBefore,fnSuccess,fnError,fnComplete,hasPostData=f.filestack.length>0||!$.isEmptyObject(f.uploadExtraData),setAllUploaded;f.formdata=new FormData();if(total===0||!hasPostData||f._abort(params)){return}setAllUploaded=function(){$.each(files,function(a){f.updateStack(a,undefined)});f._clearFileInput()};fnBefore=function(b){f.lock();var c=f._getOutData(b);f.ajaxAborted=false;if(f.showPreview){f._getThumbs().each(function(){var a=$(this),$btnUpload=a.find('.kv-file-upload'),$btnDelete=a.find('.kv-file-remove');if(!a.hasClass('file-preview-success')){f._setThumbStatus(a,'Loading');v.addCss(a,'file-uploading')}$btnUpload.attr('disabled',true);$btnDelete.attr('disabled',true)})}f._raise('filebatchpreupload',[c]);if(f._abort(c)){b.abort();f._getThumbs().each(function(){var a=$(this),$btnUpload=a.find('.kv-file-upload'),$btnDelete=a.find('.kv-file-remove');if(a.hasClass('file-preview-loading')){f._setThumbStatus(a,'New');a.removeClass('file-uploading')}$btnUpload.removeAttr('disabled');$btnDelete.removeAttr('disabled')});f._setProgressCancelled()}};fnSuccess=function(b,c,d){var e=f._getOutData(d,b),key=0,$thumbs=f._getThumbs(':not(.file-preview-success)'),keys=v.isEmpty(b)||v.isEmpty(b.errorkeys)?[]:b.errorkeys;if(v.isEmpty(b)||v.isEmpty(b.error)){f._raise('filebatchuploadsuccess',[e]);setAllUploaded();if(f.showPreview){$thumbs.each(function(){var a=$(this);f._setThumbStatus(a,'Success');a.removeClass('file-uploading');a.find('.kv-file-upload').hide().removeAttr('disabled')});f._initUploadSuccess(b)}else{f.reset()}f._setProgress(101)}else{if(f.showPreview){$thumbs.each(function(){var a=$(this),i=a.attr('data-fileindex');a.removeClass('file-uploading');a.find('.kv-file-upload').removeAttr('disabled');a.find('.kv-file-remove').removeAttr('disabled');if(keys.length===0||$.inArray(key,keys)!==-1){f._setPreviewError(a,i,f.filestack[i],f.retryErrorUploads);if(!f.retryErrorUploads){a.find('.kv-file-upload').hide();f.updateStack(i,undefined)}}else{a.find('.kv-file-upload').hide();f._setThumbStatus(a,'Success');f.updateStack(i,undefined)}if(!a.hasClass('file-preview-error')||f.retryErrorUploads){key++}});f._initUploadSuccess(b)}f._showUploadError(b.error,e,'filebatchuploaderror');f._setProgress(101,f.$progress,f.msgUploadError)}};fnComplete=function(){f.unlock();f._initSuccessThumbs();f._clearFileInput();f._raise('filebatchuploadcomplete',[f.filestack,f._getExtraData()])};fnError=function(b,c,d){var e=f._getOutData(b),op=f.ajaxOperations.uploadBatch,errMsg=f._parseError(op,b,d);f._showUploadError(errMsg,e,'filebatchuploaderror');f.uploadFileCount=total-1;if(!f.showPreview){return}f._getThumbs().each(function(){var a=$(this),key=a.attr('data-fileindex');a.removeClass('file-uploading');if(f.filestack[key]!==undefined){f._setPreviewError(a)}});f._getThumbs().removeClass('file-uploading');f._getThumbs(' .kv-file-upload').removeAttr('disabled');f._getThumbs(' .kv-file-delete').removeAttr('disabled');f._setProgress(101,f.$progress,f.msgAjaxProgressError.replace('{operation}',op))};$.each(files,function(a,b){if(!v.isEmpty(files[a])){f.formdata.append(f.uploadFileAttr,b,f.filenames[a])}});f._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError)},_uploadExtraOnly:function(){var e=this,params={},fnBefore,fnSuccess,fnComplete,fnError;e.formdata=new FormData();if(e._abort(params)){return}fnBefore=function(a){e.lock();var b=e._getOutData(a);e._raise('filebatchpreupload',[b]);e._setProgress(50);params.data=b;params.xhr=a;if(e._abort(params)){a.abort();e._setProgressCancelled()}};fnSuccess=function(a,b,c){var d=e._getOutData(c,a);if(v.isEmpty(a)||v.isEmpty(a.error)){e._raise('filebatchuploadsuccess',[d]);e._clearFileInput();e._initUploadSuccess(a);e._setProgress(101)}else{e._showUploadError(a.error,d,'filebatchuploaderror')}};fnComplete=function(){e.unlock();e._clearFileInput();e._raise('filebatchuploadcomplete',[e.filestack,e._getExtraData()])};fnError=function(a,b,c){var d=e._getOutData(a),op=e.ajaxOperations.uploadExtra,errMsg=e._parseError(op,a,c);params.data=d;e._showUploadError(errMsg,d,'filebatchuploaderror');e._setProgress(101,e.$progress,e.msgAjaxProgressError.replace('{operation}',op))};e._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError)},_deleteFileIndex:function(b){var c=this,ind=b.attr('data-fileindex'),rev=c.reversePreviewOrder;if(ind.substring(0,5)==='init_'){ind=parseInt(ind.replace('init_',''));c.initialPreview=v.spliceArray(c.initialPreview,ind,rev);c.initialPreviewConfig=v.spliceArray(c.initialPreviewConfig,ind,rev);c.initialPreviewThumbTags=v.spliceArray(c.initialPreviewThumbTags,ind,rev);c.getFrames().each(function(){var a=$(this),nInd=a.attr('data-fileindex');if(nInd.substring(0,5)==='init_'){nInd=parseInt(nInd.replace('init_',''));if(nInd>ind){nInd--;a.attr('data-fileindex','init_'+nInd)}}});if(c.uploadAsync){c.cacheInitialPreview=c.getPreview()}}},_initFileActions:function(){var c=this,$preview=c.$preview;if(!c.showPreview){return}c._initZoomButton();c.getFrames(' .kv-file-remove').each(function(){var b=$(this),$frame=b.closest(v.FRAMES),hasError,id=$frame.attr('id'),ind=$frame.attr('data-fileindex'),n,cap,status;c._handler(b,'click',function(){status=c._raise('filepreremove',[id,ind]);if(status===false||!c._validateMinCount()){return false}hasError=$frame.hasClass('file-preview-error');v.cleanMemory($frame);$frame.fadeOut('slow',function(){v.cleanZoomCache($preview.find('#zoom-'+id));c.updateStack(ind,undefined);c._clearObjects($frame);$frame.remove();if(id&&hasError){c.$errorContainer.find('li[data-file-id="'+id+'"]').fadeOut('fast',function(){$(this).remove();if(!c._errorsExist()){c._resetErrors()}})}c._clearFileInput();var a=c.getFileStack(true),chk=c.previewCache.count(),len=a.length,hasThumb=c.showPreview&&c.getFrames().length;if(len===0&&chk===0&&!hasThumb){c.reset()}else{n=chk+len;cap=n>1?c._getMsgSelected(n):(a[0]?c._getFileNames()[0]:'');c._setCaption(cap)}c._raise('fileremoved',[id,ind])})})});c.getFrames(' .kv-file-upload').each(function(){var b=$(this);c._handler(b,'click',function(){var a=b.closest(v.FRAMES),ind=a.attr('data-fileindex');c.$progress.hide();if(a.hasClass('file-preview-error')&&!c.retryErrorUploads){return}c._uploadSingle(ind,false)})})},_initPreviewActions:function(){var g=this,$preview=g.$preview,deleteExtraData=g.deleteExtraData||{},btnRemove=v.FRAMES+' .kv-file-remove',settings=g.fileActionSettings,origClass=settings.removeClass,errClass=settings.removeErrorClass,resetProgress=function(){var a=g.isAjaxUpload?g.previewCache.count():g.$element.get(0).files.length;if(!$preview.find(v.FRAMES).length&&!a){g._setCaption('');g.reset();g.initialCaption=''}};g._initZoomButton();$preview.find(btnRemove).each(function(){var e=$(this),vUrl=e.data('url')||g.deleteUrl,vKey=e.data('key'),fnBefore,fnSuccess,fnError;var f=e.closest(v.FRAMES),cache=g.previewCache.data,settings,params,index=f.attr('data-fileindex'),config,extraData;if(g.deleteLocal){g._handler(e,'click',function(){if(!g._validateMinCount()){return false}var n,cap;f.fadeOut('slow',function(){index=parseInt((f.attr('data-fileindex')).replace('init_',''));g.previewCache.unset(index);g._deleteFileIndex(f);n=g.previewCache.count();cap=n>0?g._getMsgSelected(n):'';g._setCaption(cap);g._raise('filedeleted',[vKey,null,extraData]);v.cleanZoomCache($preview.find('#zoom-'+f.attr('id')));g._clearObjects(f);f.remove();resetProgress()})});return}if(v.isEmpty(vUrl)||vKey===undefined){return}index=parseInt(index.replace('init_',''));config=v.isEmpty(cache.config)&&v.isEmpty(cache.config[index])?null:cache.config[index];extraData=v.isEmpty(config)||v.isEmpty(config.extra)?deleteExtraData:config.extra;if(typeof extraData==="function"){extraData=extraData()}params={id:e.attr('id'),key:vKey,extra:extraData};fnBefore=function(a){g.ajaxAborted=false;g._raise('filepredelete',[vKey,a,extraData]);if(g._abort()){a.abort()}else{e.removeClass(errClass);v.addCss(f,'file-uploading');v.addCss(e,'disabled '+origClass)}};fnSuccess=function(a,b,c){var n,cap;if(!v.isEmpty(a)&&!v.isEmpty(a.error)){params.jqXHR=c;params.response=a;g._showError(a.error,params,'filedeleteerror');f.removeClass('file-uploading');e.removeClass('disabled '+origClass).addClass(errClass);resetProgress();return}f.removeClass('file-uploading').addClass('file-deleted');f.fadeOut('slow',function(){index=parseInt((f.attr('data-fileindex')).replace('init_',''));g.previewCache.unset(index);g._deleteFileIndex(f);n=g.previewCache.count();cap=n>0?g._getMsgSelected(n):'';g._setCaption(cap);g._raise('filedeleted',[vKey,c,extraData]);v.cleanZoomCache($preview.find('#zoom-'+f.attr('id')));g._clearObjects(f);f.remove();resetProgress()})};fnError=function(a,b,c){var d=g.ajaxOperations.deleteThumb,errMsg=g._parseError(d,a,c);params.jqXHR=a;params.response={};g._showError(errMsg,params,'filedeleteerror');f.removeClass('file-uploading');e.removeClass('disabled '+origClass).addClass(errClass);resetProgress()};g._initAjaxSettings();g._mergeAjaxCallback('beforeSend',fnBefore,'delete');g._mergeAjaxCallback('success',fnSuccess,'delete');g._mergeAjaxCallback('error',fnError,'delete');settings=$.extend(true,{},{url:vUrl,type:'POST',dataType:'json',data:$.extend(true,{},{key:vKey},extraData)},g._ajaxDeleteSettings);g._handler(e,'click',function(){if(!g._validateMinCount()){return false}g.ajaxAborted=false;g._raise('filebeforedelete',[vKey,extraData]);if(g.ajaxAborted instanceof Promise){g.ajaxAborted.then(function(a){if(!a){$.ajax(settings)}})}else{if(!g.ajaxAborted){$.ajax(settings)}}})})},_hideFileIcon:function(){var a=this;if(a.overwriteInitial){a.$captionContainer.removeClass('icon-visible')}},_showFileIcon:function(){var a=this;v.addCss(a.$captionContainer,'icon-visible')},_getSize:function(a){var b=this,size=parseFloat(a),i,func=b.fileSizeGetter,sizes,out;if(!$.isNumeric(a)||!$.isNumeric(size)){return''}if(typeof func==='function'){out=func(size)}else{if(size===0){out='0.00 B'}else{i=Math.floor(Math.log(size)/Math.log(1024));sizes=['B','KB','MB','GB','TB','PB','EB','ZB','YB'];out=(size/Math.pow(1024,i)).toFixed(2)*1+' '+sizes[i]}}return b._getLayoutTemplate('size').replace('{sizeText}',out)},_generatePreviewTemplate:function(h,i,j,k,l,m,n,o,p,q,r){var s=this,caption=s.slug(j),prevContent,zoomContent='',styleAttribs='',screenW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,config=screenW<400?(s.previewSettingsSmall[h]||s.defaults.previewSettingsSmall[h]):(s.previewSettings[h]||s.defaults.previewSettings[h]),footer=p||s._renderFileFooter(caption,n,'auto',m),hasIconSetting=s._getPreviewIcon(j),typeCss='type-default',forcePrevIcon=hasIconSetting&&s.preferIconicPreview,forceZoomIcon=hasIconSetting&&s.preferIconicZoomPreview,getContent;if(config){$.each(config,function(a,b){styleAttribs+=a+':'+b+';'})}getContent=function(c,d,e,f){var g=e?'zoom-'+l:l,tmplt=s._getPreviewTemplate(c),css=(o||'')+' '+f;if(s.frameClass){css=s.frameClass+' '+css}if(e){css=css.replace(' '+v.SORT_CSS,'')}tmplt=s._parseFilePreviewIcon(tmplt,j);if(c==='text'){d=v.htmlEncode(d)}if(h==='object'&&!k){$.each(s.defaults.fileTypeSettings,function(a,b){if(a==='object'||a==='other'){return}if(b(j,k)){typeCss='type-'+a}})}return tmplt.setTokens({'previewId':g,'caption':caption,'frameClass':css,'type':k,'fileindex':q,'typeCss':typeCss,'footer':footer,'data':d,'template':r||h,'style':styleAttribs?'style="'+styleAttribs+'"':''})};q=q||l.slice(l.lastIndexOf('-')+1);if(s.fileActionSettings.showZoom){zoomContent=getContent((forceZoomIcon?'other':h),i,true,'kv-zoom-thumb')}zoomContent='\n'+s._getLayoutTemplate('zoomCache').replace('{zoomContent}',zoomContent);prevContent=getContent((forcePrevIcon?'other':h),i,false,'kv-preview-thumb');return prevContent+zoomContent},_addToPreview:function(a,b){var c=this;return c.reversePreviewOrder?a.prepend(b):a.append(b)},_previewDefault:function(a,b,c){var d=this,$preview=d.$preview;if(!d.showPreview){return}var e=a?a.name:'',ftype=a?a.type:'',content,size=a.size||0,caption=d.slug(e),isError=c===true&&!d.isAjaxUpload,data=v.objUrl.createObjectURL(a);d._clearDefaultPreview();content=d._generatePreviewTemplate('other',data,e,ftype,b,isError,size);d._addToPreview($preview,content);d._setThumbAttr(b,caption,size);if(c===true&&d.isAjaxUpload){d._setThumbStatus($('#'+b),'Error')}},_previewFile:function(i,c,d,e,f,g){if(!this.showPreview){return}var h=this,fname=c?c.name:'',ftype=g.type,caption=g.name,cat=h._parseFileType(ftype,fname),types=h.allowedPreviewTypes,content,mimes=h.allowedPreviewMimeTypes,$preview=h.$preview,fsize=c.size||0,chkTypes=types&&types.indexOf(cat)>=0,chkMimes=mimes&&mimes.indexOf(ftype)!==-1,iData=(cat==='text'||cat==='html'||cat==='image')?d.target.result:f;if(cat==='html'&&h.purifyHtml&&window.DOMPurify){iData=window.DOMPurify.sanitize(iData)}if(chkTypes||chkMimes){content=h._generatePreviewTemplate(cat,iData,fname,ftype,e,false,fsize);h._clearDefaultPreview();h._addToPreview($preview,content);var j=$preview.find('#'+e+' img');if(j.length&&h.autoOrientImage){v.validateOrientation(c,function(a){if(!a){h._validateImage(e,caption,ftype,fsize,iData);return}var b=$preview.find('#zoom-'+e+' img'),css='rotate-'+a;if(a>4){css+=(j.width()>j.height()?' is-portrait-gt4':' is-landscape-gt4')}v.addCss(j,css);v.addCss(b,css);h._raise('fileimageoriented',{'$img':j,'file':c});h._validateImage(e,caption,ftype,fsize,iData);v.adjustOrientedImage(j)})}else{h._validateImage(e,caption,ftype,fsize,iData)}}else{h._previewDefault(c,e)}h._setThumbAttr(e,caption,fsize);h._initSortable()},_setThumbAttr:function(a,b,c){var d=this,$frame=$('#'+a);if($frame.length){c=c&&c>0?d._getSize(c):'';$frame.data({'caption':b,'size':c})}},_setInitThumbAttr:function(){var a=this,data=a.previewCache.data,len=a.previewCache.count(),config,caption,size,previewId;if(len===0){return}for(var i=0;i<len;i++){config=data.config[i];previewId=a.previewInitId+'-'+'init_'+i;caption=v.ifSet('caption',config,v.ifSet('filename',config));size=v.ifSet('size',config);a._setThumbAttr(previewId,caption,size)}},_slugDefault:function(a){return v.isEmpty(a)?'':String(a).replace(/[\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,'_')},_updateFileDetails:function(a){var b=this,$el=b.$element,fileStack=b.getFileStack(),name=(v.isIE(9)&&v.findFileName($el.val()))||($el[0].files[0]&&$el[0].files[0].name)||(fileStack.length&&fileStack[0].name)||'',label=b.slug(name),n=b.isAjaxUpload?fileStack.length:a,nFiles=b.previewCache.count()+n,log=n===1?label:b._getMsgSelected(nFiles);if(b.isError){b.$previewContainer.removeClass('file-thumb-loading');b.$previewStatus.html('');b.$captionContainer.removeClass('icon-visible')}else{b._showFileIcon()}b._setCaption(log,b.isError);b.$container.removeClass('file-input-new file-input-ajax-new');if(arguments.length===1){b._raise('fileselect',[a,label])}if(b.previewCache.count()){b._initPreviewActions()}},_setThumbStatus:function(a,b){var c=this;if(!c.showPreview){return}var d='indicator'+b,msg=d+'Title',css='file-preview-'+b.toLowerCase(),$indicator=a.find('.file-upload-indicator'),config=c.fileActionSettings;a.removeClass('file-preview-success file-preview-error file-preview-loading');if(b==='Success'){a.find('.file-drag-handle').remove()}$indicator.html(config[d]);$indicator.attr('title',config[msg]);a.addClass(css);if(b==='Error'&&!c.retryErrorUploads){a.find('.kv-file-upload').attr('disabled',true)}},_setProgressCancelled:function(){var a=this;a._setProgress(101,a.$progress,a.msgCancelled)},_setProgress:function(p,a,b){var c=this,pct=Math.min(p,100),out,pctLimit=c.progressUploadThreshold,t=p<=100?c.progressTemplate:c.progressCompleteTemplate,template=pct<100?c.progressTemplate:(b?c.progressErrorTemplate:t);a=a||c.$progress;if(!v.isEmpty(template)){if(pctLimit&&pct>pctLimit&&p<=100){out=template.setTokens({'percent':pctLimit,'status':c.msgUploadThreshold})}else{out=template.setTokens({'percent':pct,'status':(p>100?c.msgUploadEnd:pct+'%')})}a.html(out);if(b){a.find('[role="progressbar"]').html(b)}}},_setFileDropZoneTitle:function(){var a=this,$zone=a.$container.find('.file-drop-zone'),title=a.dropZoneTitle,strFiles;if(a.isClickable){strFiles=v.isEmpty(a.$element.attr('multiple'))?a.fileSingle:a.filePlural;title+=a.dropZoneClickTitle.replace('{files}',strFiles)}$zone.find('.'+a.dropZoneTitleClass).remove();if(!a.showPreview||$zone.length===0||a.getFileStack().length>0||!a.dropZoneEnabled||(!a.isAjaxUpload&&a.$element.files)){return}if($zone.find(v.FRAMES).length===0&&v.isEmpty(a.defaultPreviewContent)){$zone.prepend('<div class="'+a.dropZoneTitleClass+'">'+title+'</div>')}a.$container.removeClass('file-input-new');v.addCss(a.$container,'file-input-ajax-new')},_setAsyncUploadStatus:function(c,d,e){var f=this,sum=0;f._setProgress(d,$('#'+c).find('.file-thumb-progress'));f.uploadStatus[c]=d;$.each(f.uploadStatus,function(a,b){sum+=b});f._setProgress(Math.floor(sum/e))},_validateMinCount:function(){var a=this,len=a.isAjaxUpload?a.getFileStack().length:a.$element.get(0).files.length;if(a.validateInitialCount&&a.minFileCount>0&&a._getFileCount(len-1)<a.minFileCount){a._noFilesError({});return false}return true},_getFileCount:function(a){var b=this,addCount=0;if(b.validateInitialCount&&!b.overwriteInitial){addCount=b.previewCache.count();a+=addCount}return a},_getFileId:function(a){var b=this,custom=b.generateFileId,relativePath;if(typeof custom==='function'){return custom(a,event)}if(!a){return null}relativePath=String(a.webkitRelativePath||a.fileName||a.name||null);if(!relativePath){return null}return(a.size+'-'+relativePath.replace(/[^0-9a-zA-Z_-]/img,''))},_getFileName:function(a){return a&&a.name?this.slug(a.name):undefined},_getFileIds:function(a){var b=this;return b.fileids.filter(function(n){return(a?n!==undefined:n!==undefined&&n!==null)})},_getFileNames:function(a){var b=this;return b.filenames.filter(function(n){return(a?n!==undefined:n!==undefined&&n!==null)})},_setPreviewError:function(a,i,b,c){var d=this;if(i!==undefined){d.updateStack(i,b)}if(!d.showPreview){return}if(d.removeFromPreviewOnError&&!c){a.remove();return}else{d._setThumbStatus(a,'Error')}d._refreshUploadButton(a,c)},_refreshUploadButton:function(a,b){var c=this,$btn=a.find('.kv-file-upload'),cfg=c.fileActionSettings,icon=cfg.uploadIcon,title=cfg.uploadTitle;if(!$btn.length){return}if(b){icon=cfg.uploadRetryIcon;title=cfg.uploadRetryTitle}$btn.attr('title',title).html(icon)},_checkDimensions:function(i,a,b,c,d,e,f){var g=this,msg,dim,tag=a==='Small'?'min':'max',limit=g[tag+'Image'+e],$imgEl,isValid;if(v.isEmpty(limit)||!b.length){return}$imgEl=b[0];dim=(e==='Width')?$imgEl.naturalWidth||$imgEl.width:$imgEl.naturalHeight||$imgEl.height;isValid=a==='Small'?dim>=limit:dim<=limit;if(isValid){return}msg=g['msgImage'+e+a].setTokens({'name':d,'size':limit});g._showUploadError(msg,f);g._setPreviewError(c,i,null)},_validateImage:function(a,b,c,d,e){var f=this,$preview=f.$preview,params,w1,w2,$thumb=$preview.find("#"+a),i=$thumb.attr('data-fileindex'),$img=$thumb.find('img'),exifObject;b=b||'Untitled';$img.one('load',function(){w1=$thumb.width();w2=$preview.width();if(w1>w2){$img.css('width','100%')}params={ind:i,id:a};f._checkDimensions(i,'Small',$img,$thumb,b,'Width',params);f._checkDimensions(i,'Small',$img,$thumb,b,'Height',params);if(!f.resizeImage){f._checkDimensions(i,'Large',$img,$thumb,b,'Width',params);f._checkDimensions(i,'Large',$img,$thumb,b,'Height',params)}f._raise('fileimageloaded',[a]);try{exifObject=window.piexif?window.piexif.load(e):null}catch(err){exifObject=null}f.loadedImages.push({ind:i,img:$img,thumb:$thumb,pid:a,typ:c,siz:d,validated:false,imgData:e,exifObj:exifObject});$thumb.data('exif',exifObject);f._validateAllImages()}).one('error',function(){f._raise('fileimageloaderror',[a])}).each(function(){if(this.complete){$(this).trigger('load')}else{if(this.error){$(this).trigger('error')}}})},_validateAllImages:function(){var a=this,i,counter={val:0},numImgs=a.loadedImages.length,config,fsize,minSize=a.resizeIfSizeMoreThan;if(numImgs!==a.totalImagesCount){return}a._raise('fileimagesloaded');if(!a.resizeImage){return}for(i=0;i<a.loadedImages.length;i++){config=a.loadedImages[i];if(config.validated){continue}fsize=config.siz;if(fsize&&fsize>minSize*1000){a._getResizedImage(config,counter,numImgs)}a.loadedImages[i].validated=true}},_getResizedImage:function(d,e,f){var g=this,img=$(d.img)[0],width=img.naturalWidth,height=img.naturalHeight,blob,ratio=1,maxWidth=g.maxImageWidth||width,maxHeight=g.maxImageHeight||height,isValidImage=!!(width&&height),chkWidth,chkHeight,canvas=g.imageCanvas,dataURI,context=g.imageCanvasContext,type=d.typ,pid=d.pid,ind=d.ind,$thumb=d.thumb,throwError,msg,exifObj=d.exifObj,exifStr;throwError=function(a,b,c){if(g.isAjaxUpload){g._showUploadError(a,b,c);}else{g._showError(a,b,c)}g._setPreviewError($thumb,ind)};if(!g.filestack[ind]||!isValidImage||(width<=maxWidth&&height<=maxHeight)){if(isValidImage&&g.filestack[ind]){g._raise('fileimageresized',[pid,ind])}e.val++;if(e.val===f){g._raise('fileimagesresized')}if(!isValidImage){throwError(g.msgImageResizeError,{id:pid,'index':ind},'fileimageresizeerror');return}}type=type||g.resizeDefaultImageType;chkWidth=width>maxWidth;chkHeight=height>maxHeight;if(g.resizePreference==='width'){ratio=chkWidth?maxWidth/width:(chkHeight?maxHeight/height:1)}else{ratio=chkHeight?maxHeight/height:(chkWidth?maxWidth/width:1)}g._resetCanvas();width*=ratio;height*=ratio;canvas.width=width;canvas.height=height;try{context.drawImage(img,0,0,width,height);dataURI=canvas.toDataURL(type,g.resizeQuality);if(exifObj){exifStr=window.piexif.dump(exifObj);dataURI=window.piexif.insert(exifStr,dataURI)}blob=v.dataURI2Blob(dataURI);g.filestack[ind]=blob;g._raise('fileimageresized',[pid,ind]);e.val++;if(e.val===f){g._raise('fileimagesresized',[undefined,undefined])}if(!(blob instanceof Blob)){throwError(g.msgImageResizeError,{id:pid,'index':ind},'fileimageresizeerror')}}catch(err){e.val++;if(e.val===f){g._raise('fileimagesresized',[undefined,undefined])}msg=g.msgImageResizeException.replace('{errors}',err.message);throwError(msg,{id:pid,'index':ind},'fileimageresizeexception')}},_initBrowse:function(a){var b=this;if(b.showBrowse){b.$btnFile=a.find('.btn-file');b.$btnFile.append(b.$element)}else{b.$element.hide()}},_initCaption:function(){var a=this,cap=a.initialCaption||'';if(a.overwriteInitial||v.isEmpty(cap)){a.$caption.val('');return false}a._setCaption(cap);return true},_setCaption:function(a,b){var c=this,title,out,icon,n,cap,stack=c.getFileStack();if(!c.$caption.length){return}c.$captionContainer.removeClass('icon-visible');if(b){title=$('<div>'+c.msgValidationError+'</div>').text();n=stack.length;if(n){cap=n===1&&stack[0]?c._getFileNames()[0]:c._getMsgSelected(n)}else{cap=c._getMsgSelected(c.msgNo)}out=v.isEmpty(a)?cap:a;icon='<span class="'+c.msgValidationErrorClass+'">'+c.msgValidationErrorIcon+'</span>'}else{if(v.isEmpty(a)){return}title=$('<div>'+a+'</div>').text();out=title;icon=c._getLayoutTemplate('fileIcon')}c.$captionContainer.addClass('icon-visible');c.$caption.attr('title',title).val(out);c.$captionIcon.html(icon)},_createContainer:function(){var a=this,attribs={"class":'file-input file-input-new'+(a.rtl?' kv-rtl':'')},$container=$(document.createElement("div")).attr(attribs).html(a._renderMain());a.$element.before($container);a._initBrowse($container);if(a.theme){$container.addClass('theme-'+a.theme)}return $container},_refreshContainer:function(){var a=this,$container=a.$container;$container.before(a.$element);$container.html(a._renderMain());a._initBrowse($container);a._validateDisabled()},_validateDisabled:function(){var a=this;a.$caption.attr({readonly:a.isDisabled})},_renderMain:function(){var a=this,dropCss=a.dropZoneEnabled?' file-drop-zone':'file-drop-disabled',close=!a.showClose?'':a._getLayoutTemplate('close'),preview=!a.showPreview?'':a._getLayoutTemplate('preview').setTokens({'class':a.previewClass,'dropClass':dropCss}),css=a.isDisabled?a.captionClass+' file-caption-disabled':a.captionClass,caption=a.captionTemplate.setTokens({'class':css+' kv-fileinput-caption'});return a.mainTemplate.setTokens({'class':a.mainClass+(!a.showBrowse&&a.showCaption?' no-browse':''),'preview':preview,'close':close,'caption':caption,'upload':a._renderButton('upload'),'remove':a._renderButton('remove'),'cancel':a._renderButton('cancel'),'browse':a._renderButton('browse')})},_renderButton:function(a){var b=this,tmplt=b._getLayoutTemplate('btnDefault'),css=b[a+'Class'],title=b[a+'Title'],icon=b[a+'Icon'],label=b[a+'Label'],status=b.isDisabled?' disabled':'',btnType='button';switch(a){case'remove':if(!b.showRemove){return''}break;case'cancel':if(!b.showCancel){return''}css+=' kv-hidden';break;case'upload':if(!b.showUpload){return''}if(b.isAjaxUpload&&!b.isDisabled){tmplt=b._getLayoutTemplate('btnLink').replace('{href}',b.uploadUrl)}else{btnType='submit'}break;case'browse':if(!b.showBrowse){return''}tmplt=b._getLayoutTemplate('btnBrowse');break;default:return''}css+=a==='browse'?' btn-file':' fileinput-'+a+' fileinput-'+a+'-button';if(!v.isEmpty(label)){label=' <span class="'+b.buttonLabelClass+'">'+label+'</span>'}return tmplt.setTokens({'type':btnType,'css':css,'title':title,'status':status,'icon':icon,'label':label})},_renderThumbProgress:function(){var a=this;return'<div class="file-thumb-progress kv-hidden">'+a.progressTemplate.setTokens({'percent':'0','status':a.msgUploadBegin})+'</div>'},_renderFileFooter:function(a,b,c,d){var e=this,config=e.fileActionSettings,rem=config.showRemove,drg=config.showDrag,upl=config.showUpload,zoom=config.showZoom,out,template=e._getLayoutTemplate('footer'),tInd=e._getLayoutTemplate('indicator'),ind=d?config.indicatorError:config.indicatorNew,title=d?config.indicatorErrorTitle:config.indicatorNewTitle,indicator=tInd.setTokens({'indicator':ind,'indicatorTitle':title});b=e._getSize(b);if(e.isAjaxUpload){out=template.setTokens({'actions':e._renderFileActions(upl,false,rem,zoom,drg,false,false,false),'caption':a,'size':b,'width':c,'progress':e._renderThumbProgress(),'indicator':indicator})}else{out=template.setTokens({'actions':e._renderFileActions(false,false,false,zoom,drg,false,false,false),'caption':a,'size':b,'width':c,'progress':'','indicator':indicator})}out=v.replaceTags(out,e.previewThumbTags);return out},_renderFileActions:function(a,b,c,d,e,f,g,h,i,j,k){if(!a&&!b&&!c&&!d&&!e){return''}var l=this,vUrl=g===false?'':' data-url="'+g+'"',vKey=h===false?'':' data-key="'+h+'"',btnDelete='',btnUpload='',btnDownload='',btnZoom='',btnDrag='',css,template=l._getLayoutTemplate('actions'),config=l.fileActionSettings,otherButtons=l.otherActionButtons.setTokens({'dataKey':vKey,'key':h}),removeClass=f?config.removeClass+' disabled':config.removeClass;if(c){btnDelete=l._getLayoutTemplate('actionDelete').setTokens({'removeClass':removeClass,'removeIcon':config.removeIcon,'removeTitle':config.removeTitle,'dataUrl':vUrl,'dataKey':vKey,'key':h})}if(a){btnUpload=l._getLayoutTemplate('actionUpload').setTokens({'uploadClass':config.uploadClass,'uploadIcon':config.uploadIcon,'uploadTitle':config.uploadTitle})}if(b){btnDownload=l._getLayoutTemplate('actionDownload').setTokens({'downloadClass':config.downloadClass,'downloadIcon':config.downloadIcon,'downloadTitle':config.downloadTitle,'downloadUrl':j||l.initialPreviewDownloadUrl});btnDownload=btnDownload.setTokens({'filename':k,'key':h})}if(d){btnZoom=l._getLayoutTemplate('actionZoom').setTokens({'zoomClass':config.zoomClass,'zoomIcon':config.zoomIcon,'zoomTitle':config.zoomTitle})}if(e&&i){css='drag-handle-init '+config.dragClass;btnDrag=l._getLayoutTemplate('actionDrag').setTokens({'dragClass':css,'dragTitle':config.dragTitle,'dragIcon':config.dragIcon})}return template.setTokens({'delete':btnDelete,'upload':btnUpload,'download':btnDownload,'zoom':btnZoom,'drag':btnDrag,'other':otherButtons})},_browse:function(e){var a=this;a._raise('filebrowse');if(e&&e.isDefaultPrevented()){return}if(a.isError&&!a.isAjaxUpload){a.clear()}a.$captionContainer.focus()},_filterDuplicate:function(a,b,c){var d=this,fileId=d._getFileId(a);if(fileId&&c&&c.indexOf(fileId)>-1){return}if(!c){c=[]}b.push(a);c.push(fileId)},_change:function(e){var f=this;if(f.changeTriggered){return}var g=f.$element,isDragDrop=arguments.length>1,isAjaxUpload=f.isAjaxUpload,tfiles=[],files=isDragDrop?arguments[1]:g.get(0).files,total,maxCount=!isAjaxUpload&&v.isEmpty(g.attr('multiple'))?1:f.maxFileCount,len,ctr=f.filestack.length,isSingleUpload=v.isEmpty(g.attr('multiple')),flagSingle=(isSingleUpload&&ctr>0),fileIds=f._getFileIds(),throwError=function(a,b,c,d){var e=$.extend(true,{},f._getOutData({},{},files),{id:c,index:d}),p2={id:c,index:d,file:b,files:files};return isAjaxUpload?f._showUploadError(a,e):f._showError(a,p2)},maxCountCheck=function(n,m){var a=f.msgFilesTooMany.replace('{m}',m).replace('{n}',n);f.isError=throwError(a,null,null,null);f.$captionContainer.removeClass('icon-visible');f._setCaption('',true);f.$container.removeClass('file-input-new file-input-ajax-new')};f.reader=null;f._resetUpload();f._hideFileIcon();if(f.dropZoneEnabled){f.$container.find('.file-drop-zone .'+f.dropZoneTitleClass).remove()}if(isAjaxUpload){$.each(files,function(a,b){f._filterDuplicate(b,tfiles,fileIds)})}else{if(e.target&&e.target.files===undefined){files=e.target.value?[{name:e.target.value.replace(/^.+\\/,'')}]:[]}else{files=e.target.files||{}}tfiles=files}if(v.isEmpty(tfiles)||tfiles.length===0){if(!isAjaxUpload){f.clear()}f._raise('fileselectnone');return}f._resetErrors();len=tfiles.length;total=f._getFileCount(isAjaxUpload?(f.getFileStack().length+len):len);if(maxCount>0&&total>maxCount){if(!f.autoReplace||len>maxCount){maxCountCheck((f.autoReplace&&len>maxCount?len:total),maxCount);return}if(total>maxCount){f._resetPreviewThumbs(isAjaxUpload)}}else{if(!isAjaxUpload||flagSingle){f._resetPreviewThumbs(false);if(flagSingle){f.clearStack()}}else{if(isAjaxUpload&&ctr===0&&(!f.previewCache.count()||f.overwriteInitial)){f._resetPreviewThumbs(true)}}}if(f.isPreviewable){f.readFiles(tfiles)}else{f._updateFileDetails(1)}},_abort:function(a){var b=this,data;if(b.ajaxAborted&&typeof b.ajaxAborted==="object"&&b.ajaxAborted.message!==undefined){data=$.extend(true,{},b._getOutData(),a);data.abortData=b.ajaxAborted.data||{};data.abortMessage=b.ajaxAborted.message;b._setProgress(101,b.$progress,b.msgCancelled);b._showUploadError(b.ajaxAborted.message,data,'filecustomerror');b.cancel();return true}return!!b.ajaxAborted},_resetFileStack:function(){var b=this,i=0,newstack=[],newnames=[],newids=[];b._getThumbs().each(function(){var a=$(this),ind=a.attr('data-fileindex'),file=b.filestack[ind],pid=a.attr('id');if(ind==='-1'||ind===-1){return}if(file!==undefined){newstack[i]=file;newnames[i]=b._getFileName(file);newids[i]=b._getFileId(file);a.attr({'id':b.previewInitId+'-'+i,'data-fileindex':i});i++}else{a.attr({'id':'uploaded-'+v.uniqId(),'data-fileindex':'-1'})}b.$preview.find('#zoom-'+pid).attr({'id':'zoom-'+a.attr('id'),'data-fileindex':a.attr('data-fileindex')})});b.filestack=newstack;b.filenames=newnames;b.fileids=newids},_isFileSelectionValid:function(a){var b=this;a=a||0;if(b.required&&!b.getFilesCount()){b.$errorContainer.html('');b._showUploadError(b.msgFileRequired);return false}if(b.minFileCount>0&&b._getFileCount(a)<b.minFileCount){b._noFilesError({});return false}return true},clearStack:function(){var a=this;a.filestack=[];a.filenames=[];a.fileids=[];return a.$element},updateStack:function(i,a){var b=this;b.filestack[i]=a;b.filenames[i]=b._getFileName(a);b.fileids[i]=a&&b._getFileId(a)||null;return b.$element},addToStack:function(a){var b=this;b.filestack.push(a);b.filenames.push(b._getFileName(a));b.fileids.push(b._getFileId(a));return b.$element},getFileStack:function(a){var b=this;return b.filestack.filter(function(n){return(a?n!==undefined:n!==undefined&&n!==null)})},getFilesCount:function(){var a=this,len=a.isAjaxUpload?a.getFileStack().length:a.$element.get(0).files.length;return a._getFileCount(len)},readFiles:function(g){this.reader=new FileReader();var h=this,$el=h.$element,$preview=h.$preview,reader=h.reader,$container=h.$previewContainer,$status=h.$previewStatus,msgLoading=h.msgLoading,msgProgress=h.msgProgress,previewInitId=h.previewInitId,numFiles=g.length,settings=h.fileTypeSettings,ctr=h.filestack.length,readFile,fileTypes=h.allowedFileTypes,typLen=fileTypes?fileTypes.length:0,fileExt=h.allowedFileExtensions,strExt=v.isEmpty(fileExt)?'':fileExt.join(', '),maxPreviewSize=h.maxFilePreviewSize&&parseFloat(h.maxFilePreviewSize),canPreview=$preview.length&&(!maxPreviewSize||isNaN(maxPreviewSize)),throwError=function(a,b,c,d){var e=$.extend(true,{},h._getOutData({},{},g),{id:c,index:d}),p2={id:c,index:d,file:b,files:g},$thumb;h._previewDefault(b,c,true);if(h.isAjaxUpload){h.addToStack(undefined);setTimeout(function(){readFile(d+1)},100)}else{numFiles=0}h._initFileActions();$thumb=$('#'+c);$thumb.find('.kv-file-upload').hide();if(h.removeFromPreviewOnError){$thumb.remove()}h.isError=h.isAjaxUpload?h._showUploadError(a,e):h._showError(a,p2);h._updateFileDetails(numFiles)};h.loadedImages=[];h.totalImagesCount=0;$.each(g,function(a,b){var c=h.fileTypeSettings.image;if(c&&c(b.type)){h.totalImagesCount++}});readFile=function(i){if(v.isEmpty($el.attr('multiple'))){numFiles=1}if(i>=numFiles){if(h.isAjaxUpload&&h.filestack.length>0){h._raise('filebatchselected',[h.getFileStack()])}else{h._raise('filebatchselected',[g])}$container.removeClass('file-thumb-loading');$status.html('');return}var f=ctr+i,previewId=previewInitId+"-"+f,file=g[i],fSizeKB,j,msg,fnText=settings.text,fnImage=settings.image,fnHtml=settings.html,typ,chk,typ1,typ2,caption=file.name?h.slug(file.name):'',fileSize=(file.size||0)/1000,fileExtExpr='',previewData=v.objUrl.createObjectURL(file),fileCount=0,strTypes='',func,knownTypes=0,isText,isHtml,isImage,txtFlag,processFileLoaded=function(){var a=msgProgress.setTokens({'index':i+1,'files':numFiles,'percent':50,'name':caption});setTimeout(function(){$status.html(a);h._updateFileDetails(numFiles);readFile(i+1)},100);h._raise('fileloaded',[file,previewId,i,reader])};if(typLen>0){for(j=0;j<typLen;j++){typ1=fileTypes[j];typ2=h.msgFileTypes[typ1]||typ1;strTypes+=j===0?typ2:', '+typ2}}if(caption===false){readFile(i+1);return}if(caption.length===0){msg=h.msgInvalidFileName.replace('{name}',v.htmlEncode(file.name));throwError(msg,file,previewId,i);return}if(!v.isEmpty(fileExt)){fileExtExpr=new RegExp('\\.('+fileExt.join('|')+')$','i')}fSizeKB=fileSize.toFixed(2);if(h.maxFileSize>0&&fileSize>h.maxFileSize){msg=h.msgSizeTooLarge.setTokens({'name':caption,'size':fSizeKB,'maxSize':h.maxFileSize});throwError(msg,file,previewId,i);return}if(h.minFileSize!==null&&fileSize<=v.getNum(h.minFileSize)){msg=h.msgSizeTooSmall.setTokens({'name':caption,'size':fSizeKB,'minSize':h.minFileSize});throwError(msg,file,previewId,i);return}if(!v.isEmpty(fileTypes)&&v.isArray(fileTypes)){for(j=0;j<fileTypes.length;j+=1){typ=fileTypes[j];func=settings[typ];fileCount+=!func||(typeof func!=='function')?0:(func(file.type,file.name)?1:0)}if(fileCount===0){msg=h.msgInvalidFileType.setTokens({'name':caption,'types':strTypes});throwError(msg,file,previewId,i);return}}if(fileCount===0&&!v.isEmpty(fileExt)&&v.isArray(fileExt)&&!v.isEmpty(fileExtExpr)){chk=v.compare(caption,fileExtExpr);fileCount+=v.isEmpty(chk)?0:chk.length;if(fileCount===0){msg=h.msgInvalidFileExtension.setTokens({'name':caption,'extensions':strExt});throwError(msg,file,previewId,i);return}}if(!h.showPreview){if(h.isAjaxUpload){h.addToStack(file)}setTimeout(function(){readFile(i+1);h._updateFileDetails(numFiles)},100);h._raise('fileloaded',[file,previewId,i,reader]);return}if(!canPreview&&fileSize>maxPreviewSize){h.addToStack(file);$container.addClass('file-thumb-loading');h._previewDefault(file,previewId);h._initFileActions();h._updateFileDetails(numFiles);readFile(i+1);return}if($preview.length&&FileReader!==undefined){isText=fnText(file.type,caption);isHtml=fnHtml(file.type,caption);isImage=fnImage(file.type,caption);$status.html(msgLoading.replace('{index}',i+1).replace('{files}',numFiles));$container.addClass('file-thumb-loading');reader.onerror=function(a){h._errorHandler(a,caption)};reader.onload=function(d){var e,fileInfo,uint,byte,bytes=[],contents,mime,readTextImage=function(b){var c=new FileReader();c.onerror=function(a){h._errorHandler(a,caption)};c.onload=function(a){h._previewFile(i,file,a,previewId,previewData,fileInfo);h._initFileActions();processFileLoaded()};if(b){c.readAsText(file,h.textEncoding)}else{c.readAsDataURL(file)}};fileInfo={'name':caption,'type':file.type};$.each(settings,function(a,b){if(a!=='object'&&a!=='other'&&b(file.type,caption)){knownTypes++}});if(knownTypes===0){uint=new Uint8Array(d.target.result);for(j=0;j<uint.length;j++){byte=uint[j].toString(16);bytes.push(byte)}e=bytes.join('').toLowerCase().substring(0,8);mime=v.getMimeType(e,'','');if(v.isEmpty(mime)){contents=v.arrayBuffer2String(reader.result);mime=v.isSvg(contents)?'image/svg+xml':v.getMimeType(e,contents,file.type)}fileInfo={'name':caption,'type':mime};isText=fnText(mime,'');isHtml=fnHtml(mime,'');isImage=fnImage(mime,'');txtFlag=isText||isHtml;if(txtFlag||isImage){readTextImage(txtFlag);return}}h._previewFile(i,file,d,previewId,previewData,fileInfo);h._initFileActions();processFileLoaded()};reader.onprogress=function(a){if(a.lengthComputable){var b=(a.loaded/a.total)*100,progress=Math.ceil(b);msg=msgProgress.setTokens({'index':i+1,'files':numFiles,'percent':progress,'name':caption});setTimeout(function(){$status.html(msg)},100)}};if(isText||isHtml){reader.readAsText(file,h.textEncoding)}else{if(isImage){reader.readAsDataURL(file)}else{reader.readAsArrayBuffer(file)}}}else{h._previewDefault(file,previewId);setTimeout(function(){readFile(i+1);h._updateFileDetails(numFiles)},100);h._raise('fileloaded',[file,previewId,i,reader])}h.addToStack(file)};readFile(0);h._updateFileDetails(numFiles,false)},lock:function(){var a=this;a._resetErrors();a.disable();if(a.showRemove){a.$container.find('.fileinput-remove').hide()}if(a.showCancel){a.$container.find('.fileinput-cancel').show()}a._raise('filelock',[a.filestack,a._getExtraData()]);return a.$element},unlock:function(a){var b=this;if(a===undefined){a=true}b.enable();if(b.showCancel){b.$container.find('.fileinput-cancel').hide()}if(b.showRemove){b.$container.find('.fileinput-remove').show()}if(a){b._resetFileStack()}b._raise('fileunlock',[b.filestack,b._getExtraData()]);return b.$element},cancel:function(){var b=this,xhr=b.ajaxRequests,len=xhr.length,i;if(len>0){for(i=0;i<len;i+=1){b.cancelling=true;xhr[i].abort()}}b._setProgressCancelled();b._getThumbs().each(function(){var a=$(this),ind=a.attr('data-fileindex');a.removeClass('file-uploading');if(b.filestack[ind]!==undefined){a.find('.kv-file-upload').removeClass('disabled').removeAttr('disabled');a.find('.kv-file-remove').removeClass('disabled').removeAttr('disabled')}b.unlock()});return b.$element},clear:function(){var a=this,cap;if(!a._raise('fileclear')){return}a.$btnUpload.removeAttr('disabled');a._getThumbs().find('video,audio,img').each(function(){v.cleanMemory($(this))});a._resetUpload();a.clearStack();a._clearFileInput();a._resetErrors(true);if(a._hasInitialPreview()){a._showFileIcon();a._resetPreview();a._initPreviewActions();a.$container.removeClass('file-input-new')}else{a._getThumbs().each(function(){a._clearObjects($(this))});if(a.isAjaxUpload){a.previewCache.data={}}a.$preview.html('');cap=(!a.overwriteInitial&&a.initialCaption.length>0)?a.initialCaption:'';a.$caption.attr('title','').val(cap);v.addCss(a.$container,'file-input-new');a._validateDefaultPreview()}if(a.$container.find(v.FRAMES).length===0){if(!a._initCaption()){a.$captionContainer.removeClass('icon-visible')}}a._hideFileIcon();a._raise('filecleared');a.$captionContainer.focus();a._setFileDropZoneTitle();return a.$element},reset:function(){var a=this;if(!a._raise('filereset')){return}a._resetPreview();a.$container.find('.fileinput-filename').text('');v.addCss(a.$container,'file-input-new');if(a.getFrames().length||a.dropZoneEnabled){a.$container.removeClass('file-input-new')}a.clearStack();a.formdata={};a._setFileDropZoneTitle();return a.$element},disable:function(){var a=this;a.isDisabled=true;a._raise('filedisabled');a.$element.attr('disabled','disabled');a.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");a.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",true);v.addCss(a.$container.find('.btn-file'),'disabled');a._initDragDrop();return a.$element},enable:function(){var a=this;a.isDisabled=false;a._raise('fileenabled');a.$element.removeAttr('disabled');a.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");a.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled");a.$container.find('.btn-file').removeClass('disabled');a._initDragDrop();return a.$element},upload:function(){var a=this,totLen=a.getFileStack().length,i,outData,len,hasExtraData=!$.isEmptyObject(a._getExtraData());if(!a.isAjaxUpload||a.isDisabled||!a._isFileSelectionValid(totLen)){return}a._resetUpload();if(totLen===0&&!hasExtraData){a._showUploadError(a.msgUploadEmpty);return}a.$progress.show();a.uploadCount=0;a.uploadStatus={};a.uploadLog=[];a.lock();a._setProgress(2);if(totLen===0&&hasExtraData){a._uploadExtraOnly();return}len=a.filestack.length;a.hasInitData=false;if(a.uploadAsync){outData=a._getOutData();a._raise('filebatchpreupload',[outData]);a.fileBatchCompleted=false;a.uploadCache={content:[],config:[],tags:[],append:true};a.uploadAsyncCount=a.getFileStack().length;for(i=0;i<len;i++){a.uploadCache.content[i]=null;a.uploadCache.config[i]=null;a.uploadCache.tags[i]=null}a.$preview.find('.file-preview-initial').removeClass(v.SORT_CSS);a._initSortable();a.cacheInitialPreview=a.getPreview();for(i=0;i<len;i++){if(a.filestack[i]){a._uploadSingle(i,true)}}return}a._uploadBatch();return a.$element},destroy:function(){var a=this,$form=a.$form,$cont=a.$container,$el=a.$element,ns=a.namespace;$(document).off(ns);$(window).off(ns);if($form&&$form.length){$form.off(ns)}if(a.isAjaxUpload){a._clearFileInput()}a._cleanup();a._initPreviewCache();$el.insertBefore($cont).off(ns).removeData();$cont.off().remove();return $el},refresh:function(a,b){var c=this,$el=c.$element;if(typeof a!=='object'||v.isEmpty(a)){a=c.options}else{a=$.extend(true,{},c.options,a)}c._init(a,true);c._listen();if(b){$el.trigger('change'+c.namespace)}return $el},zoom:function(a){var b=this,$frame=b._getFrame(a),$modal=b.$modal;if(!$frame){return}v.initModal($modal);$modal.html(b._getModalContent());b._setZoomContent($frame);$modal.modal('show');b._initZoomButtons()},getExif:function(a){var b=this,$frame=b._getFrame(a);return $frame&&$frame.data('exif')||null},getFrames:function(a){var b=this,$frames;a=a||'';$frames=b.$preview.find(v.FRAMES+a);if(b.reversePreviewOrder){$frames=$($frames.get().reverse())}return $frames},getPreview:function(){var a=this;return{content:a.initialPreview,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags}}};$.fn.fileinput=function(b){if(!v.hasFileAPISupport()&&!v.isIE(9)){return}var c=Array.apply(null,arguments),retvals=[];c.shift();this.each(function(){var a=$(this),data=a.data('fileinput'),options=typeof b==='object'&&b,theme=options.theme||a.data('theme'),l={},t={},lang=options.language||a.data('language')||$.fn.fileinput.defaults.language||'en',opt;if(!data){if(theme){t=$.fn.fileinputThemes[theme]||{}}if(lang!=='en'&&!v.isEmpty($.fn.fileinputLocales[lang])){l=$.fn.fileinputLocales[lang]||{}}opt=$.extend(true,{},$.fn.fileinput.defaults,t,$.fn.fileinputLocales.en,l,options,a.data());data=new FileInput(this,opt);a.data('fileinput',data)}if(typeof b==='string'){retvals.push(data[b].apply(data,c))}});switch(retvals.length){case 0:return this;case 1:return retvals[0];default:return retvals}};$.fn.fileinput.defaults={language:'en',showCaption:true,showBrowse:true,showPreview:true,showRemove:true,showUpload:true,showCancel:true,showClose:true,showUploadedThumbs:true,browseOnZoneClick:false,autoReplace:false,autoOrientImage:true,required:false,rtl:false,hideThumbnailContent:false,generateFileId:null,previewClass:'',captionClass:'',frameClass:'krajee-default',mainClass:'file-caption-main',mainTemplate:null,purifyHtml:true,fileSizeGetter:null,initialCaption:'',initialPreview:[],initialPreviewDelimiter:'*$$*',initialPreviewAsData:false,initialPreviewFileType:'image',initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:true,initialPreviewDownloadUrl:'',removeFromPreviewOnError:false,deleteUrl:'',deleteLocal:false,deleteExtraData:{},overwriteInitial:true,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:'btn btn-navigate',next:'btn btn-navigate',toggleheader:'btn btn-sm btn-kv btn-default btn-outline-secondary',fullscreen:'btn btn-sm btn-kv btn-default btn-outline-secondary',borderless:'btn btn-sm btn-kv btn-default btn-outline-secondary',close:'btn btn-sm btn-kv btn-default btn-outline-secondary'},preferIconicPreview:false,preferIconicZoomPreview:false,allowedPreviewTypes:undefined,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:'file-other-icon',previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:'hidden-xs',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:'btn btn-primary',removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:'btn btn-default btn-secondary',cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:'btn btn-default btn-secondary',uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:'btn btn-default btn-secondary',uploadUrl:null,uploadUrlThumb:null,uploadAsync:true,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:false,resizePreference:'width',resizeQuality:0.92,resizeDefaultImageType:'image/jpeg',resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:false,msgValidationErrorClass:'text-danger',msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:'file-error-message',progressThumbClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:'image',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:v.closeButton('kv-error-close'),slugCallback:null,dropZoneEnabled:true,dropZoneTitleClass:'file-drop-zone-title',fileActionSettings:{},otherActionButtons:'',textEncoding:'UTF-8',ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:true,mergeAjaxCallbacks:false,mergeAjaxDeleteCallbacks:false,retryErrorUploads:true,reversePreviewOrder:false};$.fn.fileinputLocales.en={fileSingle:'file',filePlural:'files',browseLabel:'Browse &hellip;',removeLabel:'Remove',removeTitle:'Clear selected files',cancelLabel:'Cancel',cancelTitle:'Abort ongoing upload',uploadLabel:'Upload',uploadTitle:'Upload selected files',msgNo:'No',msgNoFilesSelected:'No files selected',msgCancelled:'Cancelled',msgPlaceholder:'Select {files}...',msgZoomModalHeading:'Detailed Preview',msgFileRequired:'You must select a file to upload.',msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:'You must select at least <b>{n}</b> {files} to upload.',msgFilesTooMany:'Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.',msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{'image':'image','html':'HTML','text':'text','video':'video','audio':'audio','flash':'flash','pdf':'PDF','object':'object'},msgUploadAborted:'The file upload was aborted',msgUploadThreshold:'Processing...',msgUploadBegin:'Initializing...',msgUploadEnd:'Done',msgUploadEmpty:'No valid data available for upload.',msgUploadError:'Error',msgValidationError:'Validation Error',msgLoading:'Loading file {index} of {files} &hellip;',msgProgress:'Loading file {index} of {files} - {name} - {percent}% completed.',msgSelected:'{n} {files} selected',msgFoldersNotAllowed:'Drag & drop files only! {n} folder(s) dropped were skipped.',msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:'Could not get the image dimensions to resize.',msgImageResizeException:'Error while resizing the image.<pre>{errors}</pre>',msgAjaxError:'Something went wrong with the {operation} operation. Please try again later!',msgAjaxProgressError:'{operation} failed',ajaxOperations:{deleteThumb:'file delete',uploadThumb:'file upload',uploadBatch:'batch file upload',uploadExtra:'form data upload'},dropZoneTitle:'Drag & drop files here &hellip;',dropZoneClickTitle:'<br>(or click to select {files})',previewZoomButtonTitles:{prev:'View previous file',next:'View next file',toggleheader:'Toggle header',fullscreen:'Toggle full screen',borderless:'Toggle borderless mode',close:'Close detailed preview'}};$.fn.fileinput.Constructor=FileInput;$(document).ready(function(){var a=$('input.file[type=file]');if(a.length){a.fileinput()}})}));